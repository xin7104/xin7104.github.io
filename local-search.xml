<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>25-4-26</title>
    <link href="/2025/04/26/25-4-26/"/>
    <url>/2025/04/26/25-4-26/</url>
    
    <content type="html"><![CDATA[<figure class="highlight sas"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sas">hexo clean <span class="hljs-variable">&amp;&amp;</span> hexo g <span class="hljs-variable">&amp;&amp;</span> hexo d<br></code></pre></td></tr></table></figure><h1 id="今日份"><a href="#今日份" class="headerlink" title="今日份"></a>今日份</h1><p>总算是有点进展了捏，把第二个摄像头安上去了,安在了第一个的上面。</p><p>也可以扫到二维码<br>c很好</p><p>不愧是能进到06的人啊</p><p>废话不多说</p><p>二维码可以扫，每扫到变化的二维码就发数字给单片机，用串口3接收，本来要用数据包，but有问题，每次只能隔一个接收。算了，后来换成只发单个数据了，单片机接收的很好。</p><p>去吃晚饭前的代码</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>)<br>  &#123;<br>  <span class="hljs-keyword">if</span>(x!=<span class="hljs-number">1</span>)<br>   Load(<span class="hljs-number">10</span>,<span class="hljs-number">10</span>);<br>  <span class="hljs-keyword">if</span>(x==<span class="hljs-number">1</span>&amp;&amp;t==<span class="hljs-number">0</span>)&#123;<br>  out1 = PID_realize2(&amp;pidHW_Tracking,s) ;<br>  Load(<span class="hljs-number">20</span>-out1,<span class="hljs-number">20</span>+out1);<br>  &#125;<br>  <span class="hljs-keyword">if</span>(t==<span class="hljs-number">1</span>)&#123;<br>  Load(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);<br>  HAL_Delay(<span class="hljs-number">500</span>);<br>  t=<span class="hljs-number">0</span>;<br>  &#125;<br>  <span class="hljs-keyword">if</span>(g_ucUsart2ReceiveData==<span class="hljs-number">0x00</span>&amp;&amp;x==<span class="hljs-number">1</span>)&#123;<br>  HAL_Delay(<span class="hljs-number">800</span>);<br>  Load(<span class="hljs-number">15</span>,<span class="hljs-number">-15</span>);<br>  <span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>)<br>  &#123;<br>  HAL_Delay(<span class="hljs-number">1</span>);<br>  <span class="hljs-keyword">if</span>(g_ucUsart2ReceiveData!=<span class="hljs-number">0x00</span>)&#123;<span class="hljs-keyword">break</span>;&#125;<br>  &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>只要开始循迹x就会变为1，识别到新的二维码的话t变1，t每次变1就停500ms，并清零t。</p><p>摄像头循迹代码还是换了之前的</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> sensor, image, time,math,machine<br><span class="hljs-keyword">from</span> pyb <span class="hljs-keyword">import</span> UART<br><span class="hljs-keyword">from</span> vl53l1x <span class="hljs-keyword">import</span> VL53L1X<br><span class="hljs-keyword">from</span> pyb <span class="hljs-keyword">import</span> LED<br><br>uart = UART(<span class="hljs-number">3</span>, <span class="hljs-number">115200</span>)<br>green_led = LED(<span class="hljs-number">2</span>)<br>sensor.reset()<br>sensor.set_pixformat(sensor.RGB565)<br><span class="hljs-comment"># 关闭自动白平衡</span><br>sensor.set_auto_exposure(<span class="hljs-literal">False</span>)<br>sensor.set_auto_whitebal(<span class="hljs-literal">False</span>)<br>sensor.set_auto_gain(<span class="hljs-literal">False</span>)<br>sensor.set_framesize(sensor.QQVGA)<br>sensor.skip_frames(<span class="hljs-number">10</span>)<br>clock = time.clock()<br><br>red_threshold=(<span class="hljs-number">0</span>, <span class="hljs-number">86</span>, <span class="hljs-number">5</span>, <span class="hljs-number">49</span>, <span class="hljs-number">5</span>, <span class="hljs-number">68</span>)<br>green_threshold=(<span class="hljs-number">43</span>, <span class="hljs-number">100</span>, -<span class="hljs-number">35</span>, -<span class="hljs-number">128</span>, <span class="hljs-number">11</span>, <span class="hljs-number">127</span>)<br>lastx = <span class="hljs-number">0</span><br>lastx2 = <span class="hljs-number">0</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">sending_data3</span>(<span class="hljs-params">x</span>):<br>    FH = <span class="hljs-built_in">bytearray</span>([x])<br>    uart.write(FH);<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">send_uart</span>(<span class="hljs-params">deflection_angle,deflection_angle2</span>):<br>    sending_data3(<span class="hljs-number">0xA5</span>)<br>    time.sleep_ms(<span class="hljs-number">5</span>)<br>    sending_data3(deflection_angle)<br>    time.sleep_ms(<span class="hljs-number">5</span>)<br>    sending_data3(deflection_angle2)<br>    time.sleep_ms(<span class="hljs-number">5</span>)<br>    sending_data3(<span class="hljs-number">0x5B</span>)<br>    time.sleep_ms(<span class="hljs-number">5</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">find_max</span>(<span class="hljs-params">blobs</span>):<br>    max_size=<span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> blob <span class="hljs-keyword">in</span> blobs:<br>        <span class="hljs-keyword">if</span> blob[<span class="hljs-number">2</span>]*blob[<span class="hljs-number">3</span>] &gt; max_size:<br>            max_blob=blob<br>            max_size = blob[<span class="hljs-number">2</span>]*blob[<span class="hljs-number">3</span>]<br>    <span class="hljs-keyword">return</span> max_blob<br><br><span class="hljs-keyword">while</span>(<span class="hljs-literal">True</span>):<br>    clock.tick()<br>    img = sensor.snapshot()<br>    green_led.on()<br>    blobs = img.find_blobs([red_threshold])<br>    <span class="hljs-keyword">if</span> blobs:<br>        max_blob = find_max(blobs)<br>        lastx = max_blob.cx()<br>        <span class="hljs-comment">#lasty = max_blob.cy()</span><br>        img.draw_cross(max_blob.cx(), max_blob.cy())<br>        lastx=lastx-<span class="hljs-number">120</span>;<br>        d = <span class="hljs-string">&quot;%d&quot;</span> %(lastx)<br>        uart.write(<span class="hljs-string">&#x27;a&#x27;</span>);<br>        uart.write(<span class="hljs-string">&#x27;b&#x27;</span>);<br>        uart.write(d);<br>        uart.write(<span class="hljs-string">&#x27;e&#x27;</span>);<br>    <span class="hljs-keyword">else</span>:<br>        sending_data3(<span class="hljs-number">0x00</span>)<br><br>    blobs2 = img.find_blobs([green_threshold])<br>    <span class="hljs-keyword">if</span> blobs2:<br>        max_blob2 = find_max(blobs2)<br>        lastx2 = max_blob2.cx()<br>        <span class="hljs-comment">#lasty = max_blob.cy()</span><br>        img.draw_cross(max_blob2.cx(), max_blob2.cy())<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;lastx:&quot;</span>,lastx,<span class="hljs-string">&quot;lastx2:&quot;</span>,lastx2)<br><br></code></pre></td></tr></table></figure><p>发x坐标 - 120</p><p>下面是稍微改了一点点的识别二维码的代码</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 二维码识别示例</span><br><span class="hljs-keyword">import</span> sensor, image, time<br><span class="hljs-keyword">from</span> machine <span class="hljs-keyword">import</span> UART <span class="hljs-comment">#引入串口模块</span><br>sensor.reset()<br>sensor.set_pixformat(sensor.GRAYSCALE)<br>sensor.set_framesize(sensor.VGA)<br>sensor.set_windowing((<span class="hljs-number">480</span>, <span class="hljs-number">480</span>)) <span class="hljs-comment"># 看VGA分辨率中间的240x240像素。</span><br>sensor.skip_frames(<span class="hljs-number">30</span>)<br>sensor.set_auto_gain(<span class="hljs-literal">False</span>)  <span class="hljs-comment"># 必须关闭此功能，以防止图像冲洗…</span><br><br>uart = UART(<span class="hljs-number">3</span>, <span class="hljs-number">115200</span>)<br>clock = time.clock()<br>last_payload = <span class="hljs-literal">None</span>  <span class="hljs-comment"># 用来保存上一次识别到的二维码内容</span><br>THRESHOLD = (<span class="hljs-number">0</span>, <span class="hljs-number">120</span>)  <span class="hljs-comment"># 可以根据具体情况调整阈值，0 是黑色，100 是白色</span><br><span class="hljs-keyword">while</span>(<span class="hljs-literal">True</span>):<br>    clock.tick()<br>    img = sensor.snapshot()<br>   <span class="hljs-comment"># for code in img.find_qrcodes():</span><br>    <span class="hljs-comment">#    print(code)</span><br>    <span class="hljs-comment">#img.binary([THRESHOLD])  # 对图像进行二值化处理</span><br>    codes = img.find_qrcodes()<br>    <span class="hljs-keyword">if</span> codes:<br>        payload = codes[<span class="hljs-number">0</span>].payload()  <span class="hljs-comment"># 假设只识别一个二维码</span><br>        <span class="hljs-keyword">if</span> payload != last_payload:<br>            last_payload = payload<br>            <span class="hljs-built_in">print</span>(payload)<br>            <span class="hljs-keyword">if</span> payload == <span class="hljs-string">&quot;https://5v60oq.58u.cn/a/RlYaaoM/&quot;</span> <span class="hljs-keyword">or</span> payload ==<span class="hljs-string">&quot;1&quot;</span>:<br>                out = <span class="hljs-string">&quot;1&quot;</span><br>                uart.write(out)<br>                time.sleep_ms(<span class="hljs-number">50</span>)<br>            <span class="hljs-keyword">elif</span> payload == <span class="hljs-string">&quot;https://5v60oq.58u.cn/a/bDNqqqx/&quot;</span> <span class="hljs-keyword">or</span> payload ==<span class="hljs-string">&quot;2&quot;</span>:<br>                out = <span class="hljs-string">&quot;2&quot;</span><br>                uart.write(out)<br>                time.sleep_ms(<span class="hljs-number">50</span>)<br>            <span class="hljs-keyword">elif</span> payload == <span class="hljs-string">&quot;https://5v60oq.58u.cn/a/RMkwwwj/&quot;</span> <span class="hljs-keyword">or</span> payload ==<span class="hljs-string">&quot;3&quot;</span>:<br>                out = <span class="hljs-string">&quot;3&quot;</span><br>                uart.write(out)<br>                time.sleep_ms(<span class="hljs-number">50</span>)<br>            <span class="hljs-keyword">elif</span> payload == <span class="hljs-string">&quot;https://5v60oq.58u.cn/a/Ay4eeeX/&quot;</span> <span class="hljs-keyword">or</span> payload ==<span class="hljs-string">&quot;4&quot;</span>:<br>                out = <span class="hljs-string">&quot;4&quot;</span><br>                uart.write(out)<br>                time.sleep_ms(<span class="hljs-number">50</span>)<br>            <span class="hljs-keyword">elif</span> payload == <span class="hljs-string">&quot;https://5v60oq.58u.cn/a/O8eDDDV/&quot;</span> <span class="hljs-keyword">or</span> payload ==<span class="hljs-string">&quot;5&quot;</span>:<br>                out = <span class="hljs-string">&quot;5&quot;</span><br>                uart.write(out)<br>                time.sleep_ms(<span class="hljs-number">50</span>)<br>            <span class="hljs-keyword">elif</span> payload == <span class="hljs-string">&quot;https://5v60oq.58u.cn/a/O9Dmmmy/&quot;</span> <span class="hljs-keyword">or</span> payload ==<span class="hljs-string">&quot;6&quot;</span>:<br>                out = <span class="hljs-string">&quot;6&quot;</span><br>                uart.write(out)<br>                time.sleep_ms(<span class="hljs-number">50</span>)<br>            <span class="hljs-keyword">elif</span> payload == <span class="hljs-string">&quot;https://5v60oq.58u.cn/a/OdB888K/&quot;</span> <span class="hljs-keyword">or</span> payload ==<span class="hljs-string">&quot;7&quot;</span>:<br>                out = <span class="hljs-string">&quot;7&quot;</span><br>                uart.write(out)<br>                time.sleep_ms(<span class="hljs-number">50</span>)<br>            <span class="hljs-keyword">elif</span> payload == <span class="hljs-string">&quot;https://5v60oq.58u.cn/a/AGwdddv/&quot;</span> <span class="hljs-keyword">or</span> payload ==<span class="hljs-string">&quot;8&quot;</span>:<br>                out = <span class="hljs-string">&quot;8&quot;</span><br>                uart.write(out)<br>                time.sleep_ms(<span class="hljs-number">50</span>)<br>            <span class="hljs-keyword">elif</span> payload == <span class="hljs-string">&quot;https://5v60oq.58u.cn/a/AQp7778/&quot;</span> <span class="hljs-keyword">or</span> payload ==<span class="hljs-string">&quot;9&quot;</span>:<br>                out = <span class="hljs-string">&quot;9&quot;</span><br>                uart.write(out)<br>                time.sleep_ms(<span class="hljs-number">50</span>)<br>            <span class="hljs-keyword">elif</span> payload == <span class="hljs-string">&quot;https://5v60oq.58u.cn/a/R4e222J/&quot;</span> <span class="hljs-keyword">or</span> payload ==<span class="hljs-string">&quot;10&quot;</span>:<br>                out = <span class="hljs-string">&quot;10&quot;</span><br>                uart.write(out)<br>                time.sleep_ms(<span class="hljs-number">50</span>)<br>            <span class="hljs-keyword">elif</span> payload == <span class="hljs-string">&quot;https://5v60oq.58u.cn/a/AV8YYYN/&quot;</span> <span class="hljs-keyword">or</span> payload ==<span class="hljs-string">&quot;11&quot;</span>:<br>                out = <span class="hljs-string">&quot;11&quot;</span><br>                uart.write(out)<br>                time.sleep_ms(<span class="hljs-number">50</span>)<br>            <span class="hljs-keyword">elif</span> payload == <span class="hljs-string">&quot;https://5v60oq.58u.cn/a/AxqWWWQ/&quot;</span> <span class="hljs-keyword">or</span> payload ==<span class="hljs-string">&quot;12&quot;</span>:<br>                out = <span class="hljs-string">&quot;12&quot;</span><br>                uart.write(out)<br>                time.sleep_ms(<span class="hljs-number">50</span>)<br><br></code></pre></td></tr></table></figure><h2 id="其他事件"><a href="#其他事件" class="headerlink" title="其他事件"></a>其他事件</h2><p>li_wan_ling过来问我FPGA相关的，算是一无所知然后在tb里面连线？相当复杂来着，东西是集创赛里的。</p><p>我没找出问题，不过嘛,没问题才奇怪吧，她很多没改直接copy，axi_uart模块好多引脚直接接地了，总之最终输出波形为0，任重而道远啊，下面把部分代码贴出来</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-comment">/*------------------------------------------------------------------------------</span><br><span class="hljs-comment">--------------------------------------------------------------------------------</span><br><span class="hljs-comment">Copyright (c) 2016, Loongson Technology Corporation Limited.</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">All rights reserved.</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">Redistribution and use in source and binary forms, with or without modification,</span><br><span class="hljs-comment">are permitted provided that the following conditions are met:</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">1. Redistributions of source code must retain the above copyright notice, this </span><br><span class="hljs-comment">list of conditions and the following disclaimer.</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">2. Redistributions in binary form must reproduce the above copyright notice, </span><br><span class="hljs-comment">this list of conditions and the following disclaimer in the documentation and/or</span><br><span class="hljs-comment">other materials provided with the distribution.</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">3. Neither the name of Loongson Technology Corporation Limited nor the names of </span><br><span class="hljs-comment">its contributors may be used to endorse or promote products derived from this </span><br><span class="hljs-comment">software without specific prior written permission.</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND </span><br><span class="hljs-comment">ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED </span><br><span class="hljs-comment">WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE </span><br><span class="hljs-comment">DISCLAIMED. IN NO EVENT SHALL LOONGSON TECHNOLOGY CORPORATION LIMITED BE LIABLE</span><br><span class="hljs-comment">TO ANY PARTY FOR DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR </span><br><span class="hljs-comment">CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE </span><br><span class="hljs-comment">GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) </span><br><span class="hljs-comment">HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT </span><br><span class="hljs-comment">LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF</span><br><span class="hljs-comment">THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span><br><span class="hljs-comment">--------------------------------------------------------------------------------</span><br><span class="hljs-comment">------------------------------------------------------------------------------*/</span><br><span class="hljs-meta">`<span class="hljs-keyword">timescale</span> 1ns / 1ps</span><br><span class="hljs-meta">`<span class="hljs-keyword">include</span> &quot;config.h&quot;</span><br><br><span class="hljs-meta">`<span class="hljs-keyword">define</span> UART_PSEL               u_soc_top.u_axi_uart_controller.uart0.PSEL</span><br><span class="hljs-meta">`<span class="hljs-keyword">define</span> UART_PENBLE             u_soc_top.u_axi_uart_controller.uart0.PENABLE</span><br><span class="hljs-meta">`<span class="hljs-keyword">define</span> UART_PWRITE             u_soc_top.u_axi_uart_controller.uart0.PWRITE</span><br><span class="hljs-meta">`<span class="hljs-keyword">define</span> UART_WADDR              u_soc_top.u_axi_uart_controller.uart0.PADDR[7:0]</span><br><span class="hljs-meta">`<span class="hljs-keyword">define</span> UART_WDATA              u_soc_top.u_axi_uart_controller.uart0.PWDATA[7:0]</span><br><br><span class="hljs-keyword">module</span> tb_top( );<br><span class="hljs-keyword">reg</span> reset;<br><span class="hljs-keyword">reg</span> clk;<br><span class="hljs-keyword">reg</span>   [<span class="hljs-number">3</span>:<span class="hljs-number">0</span>]  touch_btn;<br><span class="hljs-keyword">reg</span>   [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>]  dip_sw;<br><br><span class="hljs-keyword">wire</span>         UART_RX;<br><span class="hljs-keyword">wire</span>         UART_TX;<br><span class="hljs-keyword">wire</span>  [<span class="hljs-number">2</span>:<span class="hljs-number">0</span>]  video_red;<br><span class="hljs-keyword">wire</span>  [<span class="hljs-number">2</span>:<span class="hljs-number">0</span>]  video_green;<br><span class="hljs-keyword">wire</span>  [<span class="hljs-number">1</span>:<span class="hljs-number">0</span>]  video_blue;<br><span class="hljs-keyword">wire</span>  video_hsync;<br><span class="hljs-keyword">wire</span>  video_vsync;<br><span class="hljs-keyword">wire</span>  video_clk;<br><span class="hljs-keyword">wire</span>  video_de;<br><span class="hljs-keyword">wire</span>  [<span class="hljs-number">15</span>:<span class="hljs-number">0</span>]  leds;<br><span class="hljs-keyword">wire</span>  [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>]  dpy0;<br><span class="hljs-keyword">wire</span>  [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>]  dpy1;<br><span class="hljs-keyword">wire</span>  [<span class="hljs-number">19</span>:<span class="hljs-number">0</span>]  base_ram_addr;<br><span class="hljs-keyword">wire</span>  [ <span class="hljs-number">3</span>:<span class="hljs-number">0</span>]  base_ram_be_n;<br><span class="hljs-keyword">wire</span>  base_ram_ce_n;<br><span class="hljs-keyword">wire</span>  base_ram_oe_n;<br><span class="hljs-keyword">wire</span>  base_ram_we_n;<br><span class="hljs-keyword">wire</span>  [<span class="hljs-number">19</span>:<span class="hljs-number">0</span>]  ext_ram_addr;<br><span class="hljs-keyword">wire</span>  [ <span class="hljs-number">3</span>:<span class="hljs-number">0</span>]  ext_ram_be_n;<br><span class="hljs-keyword">wire</span>  ext_ram_ce_n;<br><span class="hljs-keyword">wire</span>  ext_ram_oe_n;<br><span class="hljs-keyword">wire</span>  ext_ram_we_n;<br><span class="hljs-keyword">wire</span>  [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>]  base_ram_data;<br><span class="hljs-keyword">wire</span>  [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>]  ext_ram_data;<br><br><br><span class="hljs-keyword">initial</span><br><span class="hljs-keyword">begin</span><br>    clk = <span class="hljs-number">1&#x27;b0</span>;<br>    reset = <span class="hljs-number">1&#x27;b1</span>;<br>    dip_sw = <span class="hljs-number">32&#x27;h0</span>;<br>    #<span class="hljs-number">2000</span>;<br>    reset = <span class="hljs-number">1&#x27;b0</span>;<br><span class="hljs-keyword">end</span><br><span class="hljs-keyword">always</span> #<span class="hljs-number">10</span> clk=~clk;<br><br><span class="hljs-keyword">initial</span><br><span class="hljs-keyword">begin</span><br>    touch_btn = <span class="hljs-number">4&#x27;h0</span>;<br>    dip_sw    = <span class="hljs-number">32&#x27;h0000_abcd</span>;<br><br>    #<span class="hljs-number">3000000</span>;<br><br>    #<span class="hljs-number">100000</span><br>    touch_btn = <span class="hljs-number">4&#x27;b0001</span>;<br>    #<span class="hljs-number">50</span><br>    touch_btn = <span class="hljs-number">4&#x27;b0000</span>;<br><br>    #<span class="hljs-number">100000</span><br>    touch_btn = <span class="hljs-number">4&#x27;b0010</span>;<br>    #<span class="hljs-number">50</span><br>    touch_btn = <span class="hljs-number">4&#x27;b0000</span>;<br><br>    #<span class="hljs-number">100000</span><br>    touch_btn = <span class="hljs-number">4&#x27;b0100</span>;<br>    #<span class="hljs-number">50</span><br>    touch_btn = <span class="hljs-number">4&#x27;b0000</span>;<br><br>    #<span class="hljs-number">100000</span><br>    touch_btn = <span class="hljs-number">4&#x27;b1000</span>;<br>    #<span class="hljs-number">50</span><br>    touch_btn = <span class="hljs-number">4&#x27;b0000</span>;<br><br><span class="hljs-keyword">end</span><br><br>soc_top  <span class="hljs-variable">#(.SIMULATION(1&#x27;b1))</span> u_soc_top (<br>    <span class="hljs-variable">.clk</span>                     ( clk           ),<br>    <span class="hljs-variable">.reset</span>                   ( reset         ),<br>    <span class="hljs-variable">.touch_btn</span>               ( touch_btn     ),<br>    <span class="hljs-variable">.dip_sw</span>                  ( dip_sw        ),<br><br>    <span class="hljs-variable">.video_red</span>               ( video_red     ),<br>    <span class="hljs-variable">.video_green</span>             ( video_green   ),<br>    <span class="hljs-variable">.video_blue</span>              ( video_blue    ),<br>    <span class="hljs-variable">.video_hsync</span>             ( video_hsync   ),<br>    <span class="hljs-variable">.video_vsync</span>             ( video_vsync   ),<br>    <span class="hljs-variable">.video_clk</span>               ( video_clk     ),<br>    <span class="hljs-variable">.video_de</span>                ( video_de      ),<br>    <span class="hljs-variable">.leds</span>                    ( leds          ),<br>    <span class="hljs-variable">.dpy0</span>                    ( dpy0          ),<br>    <span class="hljs-variable">.dpy1</span>                    ( dpy1          ),<br><br>    <span class="hljs-variable">.base_ram_addr</span>           ( base_ram_addr   ),<br>    <span class="hljs-variable">.base_ram_be_n</span>           ( base_ram_be_n   ),<br>    <span class="hljs-variable">.base_ram_ce_n</span>           ( base_ram_ce_n   ),<br>    <span class="hljs-variable">.base_ram_oe_n</span>           ( base_ram_oe_n   ),<br>    <span class="hljs-variable">.base_ram_we_n</span>           ( base_ram_we_n   ),<br>    <span class="hljs-variable">.ext_ram_addr</span>            ( ext_ram_addr    ),<br>    <span class="hljs-variable">.ext_ram_be_n</span>            ( ext_ram_be_n    ),<br>    <span class="hljs-variable">.ext_ram_ce_n</span>            ( ext_ram_ce_n    ),<br>    <span class="hljs-variable">.ext_ram_oe_n</span>            ( ext_ram_oe_n    ),<br>    <span class="hljs-variable">.ext_ram_we_n</span>            ( ext_ram_we_n    ),<br><br>    <span class="hljs-variable">.base_ram_data</span>           ( base_ram_data   ),<br>    <span class="hljs-variable">.ext_ram_data</span>            ( ext_ram_data    ),<br><br>    <span class="hljs-variable">.UART_RX</span>                 ( UART_RX       ),<br>    <span class="hljs-variable">.UART_TX</span>                 ( UART_TX       )<br>);<br><br><br><span class="hljs-comment">//模拟串口打印</span><br><span class="hljs-keyword">wire</span> uart_display;<br><span class="hljs-keyword">wire</span> [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>] uart_data;<br><span class="hljs-keyword">wire</span> uart_wen;<br><span class="hljs-keyword">assign</span> uart_wen = (`UART_PSEL == <span class="hljs-number">1&#x27;b1</span>) &amp;&amp;  (`UART_PENBLE == <span class="hljs-number">1&#x27;b1</span>) &amp;&amp; (`UART_PWRITE == <span class="hljs-number">1&#x27;b1</span>);<br><span class="hljs-keyword">assign</span> uart_display = (uart_wen == <span class="hljs-number">1&#x27;b1</span>) &amp;&amp; (`UART_WADDR == <span class="hljs-number">8&#x27;h0</span>);<br><span class="hljs-keyword">assign</span> uart_data    = `UART_WDATA;<br><br><span class="hljs-keyword">always</span> @(<span class="hljs-keyword">posedge</span> clk)<br><span class="hljs-keyword">begin</span><br>    <span class="hljs-keyword">if</span>(uart_display)<br>    <span class="hljs-keyword">begin</span><br>        <span class="hljs-keyword">if</span>(uart_data==<span class="hljs-number">8&#x27;hff</span>)<br>        <span class="hljs-keyword">begin</span><br>            ;<span class="hljs-comment">//$finish;</span><br>        <span class="hljs-keyword">end</span><br>        <span class="hljs-keyword">else</span><br>        <span class="hljs-keyword">begin</span><br>            <span class="hljs-built_in">$write</span>(<span class="hljs-string">&quot;%c&quot;</span>,uart_data);<br>        <span class="hljs-keyword">end</span><br>    <span class="hljs-keyword">end</span><br><span class="hljs-keyword">end</span><br><br>sram_sp #(<br>    <span class="hljs-variable">.AW</span>        ( <span class="hljs-number">18</span>     ),<br>    <span class="hljs-variable">.Init_File</span>(`SRAM_Init_File))<br>base_sram_sp (<br>    <span class="hljs-variable">.ram_addr</span>                ( base_ram_addr   ),<br>    <span class="hljs-variable">.ram_be_n</span>                ( base_ram_be_n   ),<br>    <span class="hljs-variable">.ram_ce_n</span>                ( base_ram_ce_n   ),<br>    <span class="hljs-variable">.ram_oe_n</span>                ( base_ram_oe_n   ),<br>    <span class="hljs-variable">.ram_we_n</span>                ( base_ram_we_n   ),<br><br>    <span class="hljs-variable">.ram_data</span>                ( base_ram_data   )<br>);<br><br>sram_sp #(<br>    <span class="hljs-variable">.AW</span>        ( <span class="hljs-number">18</span>     ),<br>    <span class="hljs-variable">.Init_File</span>(`SRAM_Init_File))<br>ext_sram_sp (<br>    <span class="hljs-variable">.ram_addr</span>                ( ext_ram_addr   ),<br>    <span class="hljs-variable">.ram_be_n</span>                ( ext_ram_be_n   ),<br>    <span class="hljs-variable">.ram_ce_n</span>                ( ext_ram_ce_n   ),<br>    <span class="hljs-variable">.ram_oe_n</span>                ( ext_ram_oe_n   ),<br>    <span class="hljs-variable">.ram_we_n</span>                ( ext_ram_we_n   ),<br><br>    <span class="hljs-variable">.ram_data</span>                ( ext_ram_data   )<br>);<br><br><br><span class="hljs-keyword">endmodule</span><br><br></code></pre></td></tr></table></figure><p>1</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br></pre></td><td class="code"><pre><code class="hljs verilog"><span class="hljs-comment">/*------------------------------------------------------------------------------</span><br><span class="hljs-comment">--------------------------------------------------------------------------------</span><br><span class="hljs-comment">Copyright (c) 2016, Loongson Technology Corporation Limited.</span><br><span class="hljs-comment">All rights reserved.</span><br><span class="hljs-comment">Redistribution and use in source and binary forms, with or without modification,</span><br><span class="hljs-comment">are permitted provided that the following conditions are met:</span><br><span class="hljs-comment">1. Redistributions of source code must retain the above copyright notice, this </span><br><span class="hljs-comment">list of conditions and the following disclaimer.</span><br><span class="hljs-comment">2. Redistributions in binary form must reproduce the above copyright notice, </span><br><span class="hljs-comment">this list of conditions and the following disclaimer in the documentation and/or</span><br><span class="hljs-comment">other materials provided with the distribution.</span><br><span class="hljs-comment">3. Neither the name of Loongson Technology Corporation Limited nor the names of </span><br><span class="hljs-comment">its contributors may be used to endorse or promote products derived from this </span><br><span class="hljs-comment">software without specific prior written permission.</span><br><span class="hljs-comment">THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND </span><br><span class="hljs-comment">ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED </span><br><span class="hljs-comment">WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE </span><br><span class="hljs-comment">DISCLAIMED. IN NO EVENT SHALL LOONGSON TECHNOLOGY CORPORATION LIMITED BE LIABLE</span><br><span class="hljs-comment">TO ANY PARTY FOR DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR </span><br><span class="hljs-comment">CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE </span><br><span class="hljs-comment">GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) </span><br><span class="hljs-comment">HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT </span><br><span class="hljs-comment">LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF</span><br><span class="hljs-comment">THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span><br><span class="hljs-comment">--------------------------------------------------------------------------------</span><br><span class="hljs-comment">------------------------------------------------------------------------------*/</span><br><span class="hljs-meta">`<span class="hljs-keyword">include</span> &quot;config.h&quot;</span><br><span class="hljs-keyword">module</span> soc_top #(<br>    <span class="hljs-keyword">parameter</span> SIMULATION = <span class="hljs-number">1&#x27;b0</span><br>) (<br>    <span class="hljs-keyword">input</span> clk,  <span class="hljs-comment">//50MHz 时钟输入</span><br>    <span class="hljs-keyword">input</span> reset,  <span class="hljs-comment">//BTN6手动复位按钮开关，带消抖电路，按下时为1</span><br>    <span class="hljs-comment">//图像输出信号</span><br>    <span class="hljs-keyword">output</span> [<span class="hljs-number">2</span>:<span class="hljs-number">0</span>] video_red,  <span class="hljs-comment">//红色像素，3位</span><br>    <span class="hljs-keyword">output</span> [<span class="hljs-number">2</span>:<span class="hljs-number">0</span>] video_green,  <span class="hljs-comment">//绿色像素，3位</span><br>    <span class="hljs-keyword">output</span> [<span class="hljs-number">1</span>:<span class="hljs-number">0</span>] video_blue,  <span class="hljs-comment">//蓝色像素，2位</span><br>    <span class="hljs-keyword">output</span> video_hsync,  <span class="hljs-comment">//行同步（水平同步）信号</span><br>    <span class="hljs-keyword">output</span> video_vsync,  <span class="hljs-comment">//场同步（垂直同步）信号</span><br>    <span class="hljs-keyword">output</span> video_clk,  <span class="hljs-comment">//像素时钟输出</span><br>    <span class="hljs-keyword">output</span> video_de,  <span class="hljs-comment">//行数据有效信号，用于区分消隐区</span><br>    <span class="hljs-keyword">input</span> clock_btn,  <span class="hljs-comment">//BTN5手动时钟按钮开关，带消抖电路，按下时为1</span><br>    <span class="hljs-keyword">input</span> [<span class="hljs-number">3</span>:<span class="hljs-number">0</span>] touch_btn,  <span class="hljs-comment">//BTN1~BTN4，按钮开关，按下时为1</span><br>    <span class="hljs-keyword">input</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] dip_sw,  <span class="hljs-comment">//32位拨码开关，拨到“ON”时为1</span><br>    <span class="hljs-keyword">output</span> [<span class="hljs-number">15</span>:<span class="hljs-number">0</span>] leds,  <span class="hljs-comment">//16位LED，输出时1点亮</span><br>    <span class="hljs-keyword">output</span> [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>] dpy0,  <span class="hljs-comment">//数码管低位信号，包括小数点，输出1点亮</span><br>    <span class="hljs-keyword">output</span> [<span class="hljs-number">7</span>:<span class="hljs-number">0</span>] dpy1,  <span class="hljs-comment">//数码管高位信号，包括小数点，输出1点亮</span><br>    <span class="hljs-comment">//BaseRAM信号</span><br>    <span class="hljs-keyword">inout</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] base_ram_data,  <span class="hljs-comment">//BaseRAM数据，低8位与CPLD串口控制器共享</span><br>    <span class="hljs-keyword">output</span> [<span class="hljs-number">19</span>:<span class="hljs-number">0</span>] base_ram_addr,  <span class="hljs-comment">//BaseRAM地址</span><br>    <span class="hljs-keyword">output</span> [ <span class="hljs-number">3</span>:<span class="hljs-number">0</span>]   base_ram_be_n,      <span class="hljs-comment">//BaseRAM字节使能，低有效。如果不使用字节使能，请保持为0</span><br>    <span class="hljs-keyword">output</span> base_ram_ce_n,  <span class="hljs-comment">//BaseRAM片选，低有效</span><br>    <span class="hljs-keyword">output</span> base_ram_oe_n,  <span class="hljs-comment">//BaseRAM读使能，低有效</span><br>    <span class="hljs-keyword">output</span> base_ram_we_n,  <span class="hljs-comment">//BaseRAM写使能，低有效</span><br>    <span class="hljs-comment">//ExtRAM信号</span><br>    <span class="hljs-keyword">inout</span> [<span class="hljs-number">31</span>:<span class="hljs-number">0</span>] ext_ram_data,  <span class="hljs-comment">//ExtRAM数据</span><br>    <span class="hljs-keyword">output</span> [<span class="hljs-number">19</span>:<span class="hljs-number">0</span>] ext_ram_addr,  <span class="hljs-comment">//ExtRAM地址</span><br>    <span class="hljs-keyword">output</span> [ <span class="hljs-number">3</span>:<span class="hljs-number">0</span>]   ext_ram_be_n,       <span class="hljs-comment">//ExtRAM字节使能，低有效。如果不使用字节使能，请保持为0</span><br>    <span class="hljs-keyword">output</span> ext_ram_ce_n,  <span class="hljs-comment">//ExtRAM片选，低有效</span><br>    <span class="hljs-keyword">output</span> ext_ram_oe_n,  <span class="hljs-comment">//ExtRAM读使能，低有效</span><br>    <span class="hljs-keyword">output</span> ext_ram_we_n,  <span class="hljs-comment">//ExtRAM写使能，低有效</span><br>    <span class="hljs-comment">//Flash存储器信号，参考 JS28F640 芯片手册</span><br>    <span class="hljs-keyword">output</span> [<span class="hljs-number">22</span>:<span class="hljs-number">0</span>] flash_a,  <span class="hljs-comment">//Flash地址，a0仅在8bit模式有效，16bit模式无意义</span><br>    <span class="hljs-keyword">inout</span> [<span class="hljs-number">15</span>:<span class="hljs-number">0</span>] flash_d,  <span class="hljs-comment">//Flash数据</span><br>    <span class="hljs-keyword">output</span> flash_rp_n,  <span class="hljs-comment">//Flash复位信号，低有效</span><br>    <span class="hljs-keyword">output</span> flash_vpen,  <span class="hljs-comment">//Flash写保护信号，低电平时不能擦除、烧写</span><br>    <span class="hljs-keyword">output</span> flash_ce_n,  <span class="hljs-comment">//Flash片选信号，低有效</span><br>    <span class="hljs-keyword">output</span> flash_oe_n,  <span class="hljs-comment">//Flash读使能信号，低有效</span><br>    <span class="hljs-keyword">output</span> flash_we_n,  <span class="hljs-comment">//Flash写使能信号，低有效</span><br>    <span class="hljs-keyword">output</span>          flash_byte_n,       <span class="hljs-comment">//Flash 8bit模式选择，低有效。在使用flash的16位模式时请设为1</span><br>    <span class="hljs-comment">//------uart-------</span><br>    <span class="hljs-keyword">inout</span> UART_RX,  <span class="hljs-comment">//串口RX接收</span><br>    <span class="hljs-keyword">inout</span> UART_TX  <span class="hljs-comment">//串口TX发送</span><br>);<br>  <span class="hljs-keyword">wire</span> cpu_clk;<br>  <span class="hljs-keyword">wire</span> cpu_resetn;<br>  <span class="hljs-keyword">wire</span> sys_clk;<br>  <span class="hljs-keyword">wire</span> sys_resetn;<br>  <span class="hljs-keyword">generate</span><br>    <span class="hljs-keyword">if</span> (SIMULATION) <span class="hljs-keyword">begin</span> : sim_clk<br>      <span class="hljs-comment">//simulation clk.</span><br>      <span class="hljs-keyword">reg</span> clk_sim;<br>      <span class="hljs-keyword">initial</span> <span class="hljs-keyword">begin</span><br>        clk_sim = <span class="hljs-number">1&#x27;b0</span>;<br>      <span class="hljs-keyword">end</span><br>      <span class="hljs-keyword">always</span> #<span class="hljs-number">15</span> clk_sim = ~clk_sim;<br>      <span class="hljs-keyword">assign</span> cpu_clk = clk_sim;<br>      <span class="hljs-keyword">assign</span> sys_clk = clk;<br>      rst_sync u_rst_sys (<br>          <span class="hljs-variable">.clk</span>(sys_clk),<br>          <span class="hljs-variable">.rst_n_in</span>(~reset),<br>          <span class="hljs-variable">.rst_n_out</span>(sys_resetn)<br>      );<br>      rst_sync u_rst_cpu (<br>          <span class="hljs-variable">.clk</span>(cpu_clk),<br>          <span class="hljs-variable">.rst_n_in</span>(sys_resetn),<br>          <span class="hljs-variable">.rst_n_out</span>(cpu_resetn)<br>      );<br>    <span class="hljs-keyword">end</span> <span class="hljs-keyword">else</span> <span class="hljs-keyword">begin</span> : pll_clk<br>      clk_pll u_clk_pll (<br>          <span class="hljs-variable">.cpu_clk</span>(cpu_clk),<br>          <span class="hljs-variable">.sys_clk</span>(sys_clk),<br>          <span class="hljs-variable">.resetn</span> (~reset),<br>          <span class="hljs-variable">.locked</span> (pll_locked),<br>          <span class="hljs-variable">.clk_in1</span>(clk)<br>      );<br>      rst_sync u_rst_sys (<br>          <span class="hljs-variable">.clk</span>(sys_clk),<br>          <span class="hljs-variable">.rst_n_in</span>(pll_locked),<br>          <span class="hljs-variable">.rst_n_out</span>(sys_resetn)<br>      );<br>      rst_sync u_rst_cpu (<br>          <span class="hljs-variable">.clk</span>(cpu_clk),<br>          <span class="hljs-variable">.rst_n_in</span>(sys_resetn),<br>          <span class="hljs-variable">.rst_n_out</span>(cpu_resetn)<br>      );<br>    <span class="hljs-keyword">end</span><br>  <span class="hljs-keyword">endgenerate</span><br>  <span class="hljs-comment">//<span class="hljs-doctag">TODO:</span> add your code</span><br>  <span class="hljs-comment">//例化OpenLA500处理器核</span><br>  core_top u_cpu (<br>      <span class="hljs-comment">//外部中断信号</span><br>      <span class="hljs-variable">.intrpt</span>(<span class="hljs-number">8&#x27;h0</span>),  <span class="hljs-comment">//high active</span><br>      <span class="hljs-variable">.aclk</span>(cpu_clk),<br>      <span class="hljs-variable">.aresetn</span>(cpu_resetn),  <span class="hljs-comment">//low active</span><br>      <span class="hljs-comment">//读地址通道</span><br>      <span class="hljs-variable">.arid</span>(cpu_arid),<br>      <span class="hljs-variable">.araddr</span>(cpu_araddr),<br>      <span class="hljs-variable">.arlen</span>(cpu_arlen),<br>      <span class="hljs-variable">.arsize</span>(cpu_arsize),<br>      <span class="hljs-variable">.arburst</span>(cpu_arburst),<br>      <span class="hljs-variable">.arlock</span>(cpu_arlock),<br>      <span class="hljs-variable">.arcache</span>(cpu_arcache),<br>      <span class="hljs-variable">.arprot</span>(cpu_arprot),<br>      <span class="hljs-variable">.arvalid</span>(cpu_arvalid),<br>      <span class="hljs-variable">.arready</span>(cpu_arready),<br>      <span class="hljs-comment">//读数据通道</span><br>      <span class="hljs-variable">.rid</span>(cpu_rid),<br>      <span class="hljs-variable">.rdata</span>(cpu_rdata),<br>      <span class="hljs-variable">.rresp</span>(cpu_rresp),<br>      <span class="hljs-variable">.rlast</span>(cpu_rlast),<br>      <span class="hljs-variable">.rvalid</span>(cpu_rvalid),<br>      <span class="hljs-variable">.rready</span>(cpu_rready),<br>      <span class="hljs-comment">//写地址通道</span><br>      <span class="hljs-variable">.awid</span>(cpu_awid),<br>      <span class="hljs-variable">.awaddr</span>(cpu_awaddr),<br>      <span class="hljs-variable">.awlen</span>(cpu_awlen),<br>      <span class="hljs-variable">.awsize</span>(cpu_awsize),<br>      <span class="hljs-variable">.awburst</span>(cpu_awburst),<br>      <span class="hljs-variable">.awlock</span>(cpu_awlock),<br>      <span class="hljs-variable">.awcache</span>(cpu_awcache),<br>      <span class="hljs-variable">.awprot</span>(cpu_awprot),<br>      <span class="hljs-variable">.awvalid</span>(cpu_awvalid),<br>      <span class="hljs-variable">.awready</span>(cpu_awready),<br>      <span class="hljs-comment">//写数据通道</span><br>      <span class="hljs-variable">.wid</span>(cpu_wid),<br>      <span class="hljs-variable">.wdata</span>(cpu_wdata),<br>      <span class="hljs-variable">.wstrb</span>(cpu_wstrb),<br>      <span class="hljs-variable">.wlast</span>(cpu_wlast),<br>      <span class="hljs-variable">.wvalid</span>(cpu_wvalid),<br>      <span class="hljs-variable">.wready</span>(cpu_wready),<br>      <span class="hljs-comment">//写响应通道</span><br>      <span class="hljs-variable">.bid</span>(cpu_bid),<br>      <span class="hljs-variable">.bresp</span>(cpu_bresp),<br>      <span class="hljs-variable">.bvalid</span>(cpu_bvalid),<br>      <span class="hljs-variable">.bready</span>(cpu_bready),<br>      <span class="hljs-comment">//已弃用</span><br>      <span class="hljs-variable">.break_point</span>(<span class="hljs-number">1&#x27;b0</span>),<br>      <span class="hljs-variable">.infor_flag</span>(<span class="hljs-number">1&#x27;b0</span>),<br>      <span class="hljs-variable">.reg_num</span>(<span class="hljs-number">5&#x27;b0</span>),<br>      <span class="hljs-variable">.ws_valid</span>(),<br>      <span class="hljs-variable">.rf_rdata</span>(),<br>      <span class="hljs-comment">//写回阶段提供的调试信息</span><br>      <span class="hljs-variable">.debug0_wb_pc</span>(debug_wb_pc),<br>      <span class="hljs-variable">.debug0_wb_inst</span>(debug_wb_inst),<br>      <span class="hljs-variable">.debug0_wb_rf_wen</span>(debug_wb_rf_wen),<br>      <span class="hljs-variable">.debug0_wb_rf_wnum</span>(debug_wb_rf_wnum),<br>      <span class="hljs-variable">.debug0_wb_rf_wdata</span>(debug_wb_rf_wdata)<br>  );<br>  <span class="hljs-comment">//例化Axi_CDC</span><br>  Axi_CDC u_Axi_CDC (<br>      <span class="hljs-variable">.axiInClk</span> (cpu_clk),<br>      <span class="hljs-variable">.axiInRst</span> (cpu_resetn),<br>      <span class="hljs-variable">.axiOutClk</span>(sys_clk),<br>      <span class="hljs-variable">.axiOutRst</span>(sys_clk),<br>      <span class="hljs-comment">//in</span><br>      <span class="hljs-comment">//aw</span><br>      <span class="hljs-variable">.axiIn_awvalid</span>(cpu_awvalid),<br>      <span class="hljs-variable">.axiIn_awready</span>(cpu_awready),<br>      <span class="hljs-variable">.axiIn_awaddr</span> (cpu_awaddr),<br>      <span class="hljs-variable">.axiIn_awid</span>   (cpu_awid),<br>      <span class="hljs-variable">.axiIn_awlen</span>  (cpu_awlen),<br>      <span class="hljs-variable">.axiIn_awsize</span> (cpu_awsize),<br>      <span class="hljs-variable">.axiIn_awburst</span>(cpu_awburst),<br>      <span class="hljs-variable">.axiIn_awlock</span> (cpu_awlock),<br>      <span class="hljs-variable">.axiIn_awcache</span>(cpu_awcache),<br>      <span class="hljs-variable">.axiIn_awprot</span> (cpu_awprot),<br>      <span class="hljs-comment">//w</span><br>      <span class="hljs-variable">.axiIn_wvalid</span>(cpu_wvalid),<br>      <span class="hljs-variable">.axiIn_wready</span>(cpu_wready),<br>      <span class="hljs-variable">.axiIn_wdata</span> (cpu_wdata),<br>      <span class="hljs-variable">.axiIn_wstrb</span> (cpu_wstrb),<br>      <span class="hljs-variable">.axiIn_wlast</span> (cpu_wlast),<br>      <span class="hljs-comment">//b</span><br>      <span class="hljs-variable">.axiIn_bready</span>(cpu_bready),<br>      <span class="hljs-variable">.axiIn_bvalid</span>(cpu_bvalid),<br>      <span class="hljs-variable">.axiIn_bid</span>   (cpu_bid),<br>      <span class="hljs-variable">.axiIn_bresp</span> (cpu_bresp),<br>      <span class="hljs-comment">//ar</span><br>      <span class="hljs-variable">.axiIn_arvalid</span>(cpu_arvalid),<br>      <span class="hljs-variable">.axiIn_arready</span>(cpu_arready),<br>      <span class="hljs-variable">.axiIn_araddr</span> (cpu_araddr),<br>      <span class="hljs-variable">.axiIn_arid</span>   (cpu_arid),<br>      <span class="hljs-variable">.axiIn_arlen</span>  (cpu_arlen),<br>      <span class="hljs-variable">.axiIn_arsize</span> (cpu_arsize),<br>      <span class="hljs-variable">.axiIn_arburst</span>(cpu_arburst),<br>      <span class="hljs-variable">.axiIn_arlock</span> (cpu_arlock),<br>      <span class="hljs-variable">.axiIn_arcache</span>(cpu_arcache),<br>      <span class="hljs-variable">.axiIn_arprot</span> (cpu_arprot),<br>      <span class="hljs-comment">//r</span><br>      <span class="hljs-variable">.axiIn_rvalid</span>(cpu_rvalid),<br>      <span class="hljs-variable">.axiIn_rready</span>(cpu_rready),<br>      <span class="hljs-variable">.axiIn_rdata</span> (cpu_rdata),<br>      <span class="hljs-variable">.axiIn_rid</span>   (cpu_rid),<br>      <span class="hljs-variable">.axiIn_rresp</span> (cpu_rresp),<br>      <span class="hljs-variable">.axiIn_rlast</span> (cpu_rlast),<br>      <span class="hljs-comment">//out</span><br>      <span class="hljs-comment">//aw</span><br>      <span class="hljs-variable">.axiOut_awvalid</span>(cpu_sync_awvalid),<br>      <span class="hljs-variable">.axiOut_awready</span>(cpu_sync_awready),<br>      <span class="hljs-variable">.axiOut_awaddr</span> (cpu_sync_awaddr),<br>      <span class="hljs-variable">.axiOut_awid</span>   (cpu_sync_awid),<br>      <span class="hljs-variable">.axiOut_awlen</span>  (cpu_sync_awlen),<br>      <span class="hljs-variable">.axiOut_awsize</span> (cpu_sync_awsize),<br>      <span class="hljs-variable">.axiOut_awburst</span>(cpu_sync_awburst),<br>      <span class="hljs-variable">.axiOut_awlock</span> (cpu_sync_awlock),<br>      <span class="hljs-variable">.axiOut_awcache</span>(cpu_sync_awcache),<br>      <span class="hljs-variable">.axiOut_awprot</span> (cpu_sync_awprot),<br>      <span class="hljs-comment">//w</span><br>      <span class="hljs-variable">.axiOut_wvalid</span>(cpu_sync_wvalid),<br>      <span class="hljs-variable">.axiOut_wready</span>(cpu_sync_wready),<br>      <span class="hljs-variable">.axiOut_wdata</span> (cpu_sync_wdata),<br>      <span class="hljs-variable">.axiOut_wstrb</span> (cpu_sync_wstrb),<br>      <span class="hljs-variable">.axiOut_wlast</span> (cpu_sync_wlast),<br>      <span class="hljs-comment">//b</span><br>      <span class="hljs-variable">.axiOut_bready</span>(cpu_sync_bready),<br>      <span class="hljs-variable">.axiOut_bvalid</span>(cpu_sync_bvalid),<br>      <span class="hljs-variable">.axiOut_bid</span>   (cpu_sync_bid),<br>      <span class="hljs-variable">.axiOut_bresp</span> (cpu_sync_bresp),<br>      <span class="hljs-comment">//ar</span><br>      <span class="hljs-variable">.axiOut_arvalid</span>(cpu_sync_arvalid),<br>      <span class="hljs-variable">.axiOut_arready</span>(cpu_sync_arready),<br>      <span class="hljs-variable">.axiOut_araddr</span> (cpu_sync_araddr),<br>      <span class="hljs-variable">.axiOut_arid</span>   (cpu_sync_arid),<br>      <span class="hljs-variable">.axiOut_arlen</span>  (cpu_sync_arlen),<br>      <span class="hljs-variable">.axiOut_arsize</span> (cpu_sync_arsize),<br>      <span class="hljs-variable">.axiOut_arburst</span>(cpu_sync_arburst),<br>      <span class="hljs-variable">.axiOut_arlock</span> (cpu_sync_arlock),<br>      <span class="hljs-variable">.axiOut_arcache</span>(cpu_sync_arcache),<br>      <span class="hljs-variable">.axiOut_arprot</span> (cpu_sync_arprot),<br>      <span class="hljs-comment">//r</span><br>      <span class="hljs-variable">.axiOut_rvalid</span>(cpu_sync_rvalid),<br>      <span class="hljs-variable">.axiOut_rready</span>(cpu_sync_rready),<br>      <span class="hljs-variable">.axiOut_rdata</span> (cpu_sync_rdata),<br>      <span class="hljs-variable">.axiOut_rid</span>   (cpu_sync_rid),<br>      <span class="hljs-variable">.axiOut_rresp</span> (cpu_sync_rresp),<br>      <span class="hljs-variable">.axiOut_rlast</span> (cpu_sync_rlast)<br>  );<br>  <span class="hljs-comment">//例化AxiCrossbar_1x4</span><br>  <span class="hljs-keyword">assign</span> axiOut_2_arready = <span class="hljs-number">1&#x27;b1</span>;<br>  <span class="hljs-keyword">assign</span> axiOut_2_rid = <span class="hljs-number">5&#x27;b0</span>;<br>  <span class="hljs-keyword">assign</span> axiOut_2_rdata = <span class="hljs-number">32&#x27;b0</span>;<br>  <span class="hljs-keyword">assign</span> axiOut_2_rresp = <span class="hljs-number">2&#x27;b0</span>;<br>  <span class="hljs-keyword">assign</span> axiOut_2_rlast = <span class="hljs-number">1&#x27;b0</span>;<br>  <span class="hljs-keyword">assign</span> axiOut_2_rvalid = <span class="hljs-number">1&#x27;b0</span>;<br>  <span class="hljs-keyword">assign</span> axiOut_2_awready = <span class="hljs-number">1&#x27;b1</span>;<br>  <span class="hljs-keyword">assign</span> axiOut_2_wready = <span class="hljs-number">1&#x27;b1</span>;<br>  <span class="hljs-keyword">assign</span> axiOut_2_bid = <span class="hljs-number">5&#x27;b0</span>;<br>  <span class="hljs-keyword">assign</span> axiOut_2_bresp = <span class="hljs-number">2&#x27;b0</span>;<br>  <span class="hljs-keyword">assign</span> axiOut_2_bvalid = <span class="hljs-number">1&#x27;b0</span>;<br>  AxiCrossbar_1x4 u_AxiCrossbar_1x4 (<br>      <span class="hljs-variable">.clk</span>   (sys_clk),<br>      <span class="hljs-variable">.resetn</span>(sys_resetn),<br>      <span class="hljs-comment">//master 0</span><br>      <span class="hljs-comment">//aw</span><br>      <span class="hljs-variable">.axiIn_awvalid</span>(cpu_sync_awvalid),<br>      <span class="hljs-variable">.axiIn_awready</span>(cpu_sync_awready),<br>      <span class="hljs-variable">.axiIn_awaddr</span> (cpu_sync_awaddr),<br>      <span class="hljs-variable">.axiIn_awid</span>   (cpu_sync_awid),<br>      <span class="hljs-variable">.axiIn_awlen</span>  (cpu_sync_awlen),<br>      <span class="hljs-variable">.axiIn_awsize</span> (cpu_sync_awsize),<br>      <span class="hljs-variable">.axiIn_awburst</span>(cpu_sync_awburst),<br>      <span class="hljs-variable">.axiIn_awlock</span> (cpu_sync_awlock),<br>      <span class="hljs-variable">.axiIn_awcache</span>(cpu_sync_awcache),<br>      <span class="hljs-variable">.axiIn_awprot</span> (cpu_sync_awprot),<br>      <span class="hljs-comment">//w</span><br>      <span class="hljs-variable">.axiIn_wvalid</span>(cpu_sync_wvalid),<br>      <span class="hljs-variable">.axiIn_wready</span>(cpu_sync_wready),<br>      <span class="hljs-variable">.axiIn_wdata</span> (cpu_sync_wdata),<br>      <span class="hljs-variable">.axiIn_wstrb</span> (cpu_sync_wstrb),<br>      <span class="hljs-variable">.axiIn_wlast</span> (cpu_sync_wlast),<br>      <span class="hljs-comment">//b</span><br>      <span class="hljs-variable">.axiIn_bready</span>(cpu_sync_bread),<br>      <span class="hljs-variable">.axiIn_bvalid</span>(cpu_sync_bvalid),<br>      <span class="hljs-variable">.axiIn_bid</span>   (cpu_sync_bid),<br>      <span class="hljs-variable">.axiIn_bresp</span> (cpu_sync_bresp),<br>      <span class="hljs-comment">//ar</span><br>      <span class="hljs-variable">.axiIn_arvalid</span>(cpu_sync_arvalid),<br>      <span class="hljs-variable">.axiIn_arready</span>(cpu_sync_arready),<br>      <span class="hljs-variable">.axiIn_araddr</span> (cpu_sync_araddr),<br>      <span class="hljs-variable">.axiIn_arid</span>   (cpu_sync_arid),<br>      <span class="hljs-variable">.axiIn_arlen</span>  (cpu_sync_arlen),<br>      <span class="hljs-variable">.axiIn_arsize</span> (cpu_sync_arsize),<br>      <span class="hljs-variable">.axiIn_arburst</span>(cpu_sync_arburst),<br>      <span class="hljs-variable">.axiIn_arlock</span> (cpu_sync_arlock),<br>      <span class="hljs-variable">.axiIn_arcache</span>(cpu_sync_arcache),<br>      <span class="hljs-variable">.axiIn_arprot</span> (cpu_sync_arprot),<br>      <span class="hljs-comment">//r</span><br>      <span class="hljs-variable">.axiIn_rvalid</span>(cpu_sync_rvalid),<br>      <span class="hljs-variable">.axiIn_rready</span>(cpu_sync_rready),<br>      <span class="hljs-variable">.axiIn_rdata</span> (cpu_sync_rdata),<br>      <span class="hljs-variable">.axiIn_rid</span>   (cpu_sync_rid),<br>      <span class="hljs-variable">.axiIn_rresp</span> (cpu_sync_rresp),<br>      <span class="hljs-variable">.axiIn_rlast</span> (cpu_sync_rlast),<br>      <span class="hljs-comment">//slave 0</span><br>      <span class="hljs-comment">//aw</span><br>      <span class="hljs-variable">.axiOut_0_awvalid</span>(ram_awvalid),<br>      <span class="hljs-variable">.axiOut_0_awready</span>(ram_awready),<br>      <span class="hljs-variable">.axiOut_0_awaddr</span> (ram_awaddr),<br>      <span class="hljs-variable">.axiOut_0_awid</span>   (ram_awid),<br>      <span class="hljs-variable">.axiOut_0_awlen</span>  (ram_awlen),<br>      <span class="hljs-variable">.axiOut_0_awsize</span> (ram_awsize),<br>      <span class="hljs-variable">.axiOut_0_awburst</span>(ram_awburst),<br>      <span class="hljs-variable">.axiOut_0_awlock</span> (ram_awlock),<br>      <span class="hljs-variable">.axiOut_0_awcache</span>(ram_awcache),<br>      <span class="hljs-variable">.axiOut_0_awprot</span> (ram_awprot),<br>      <span class="hljs-comment">//w</span><br>      <span class="hljs-variable">.axiOut_0_wvalid</span>(ram_wvalid),<br>      <span class="hljs-variable">.axiOut_0_wready</span>(ram_wready),<br>      <span class="hljs-variable">.axiOut_0_wdata</span> (ram_wdata),<br>      <span class="hljs-variable">.axiOut_0_wstrb</span> (ram_wstrb),<br>      <span class="hljs-variable">.axiOut_0_wlast</span> (ram_wlast),<br>      <span class="hljs-comment">//b</span><br>      <span class="hljs-variable">.axiOut_0_bready</span>(ram_bready),<br>      <span class="hljs-variable">.axiOut_0_bvalid</span>(ram_bvalid),<br>      <span class="hljs-variable">.axiOut_0_bid</span>   (ram_bid),<br>      <span class="hljs-variable">.axiOut_0_bresp</span> (ram_bresp),<br>      <span class="hljs-comment">//ar</span><br>      <span class="hljs-variable">.axiOut_0_arvalid</span>(ram_arvalid),<br>      <span class="hljs-variable">.axiOut_0_arready</span>(ram_arready),<br>      <span class="hljs-variable">.axiOut_0_araddr</span> (ram_araddr),<br>      <span class="hljs-variable">.axiOut_0_arid</span>   (ram_arid),<br>      <span class="hljs-variable">.axiOut_0_arlen</span>  (ram_arlen),<br>      <span class="hljs-variable">.axiOut_0_arsize</span> (ram_arsize),<br>      <span class="hljs-variable">.axiOut_0_arburst</span>(ram_arburst),<br>      <span class="hljs-variable">.axiOut_0_arlock</span> (ram_arlock),<br>      <span class="hljs-variable">.axiOut_0_arcache</span>(ram_arcache),<br>      <span class="hljs-variable">.axiOut_0_arprot</span> (ram_arprot),<br>      <span class="hljs-comment">//r</span><br>      <span class="hljs-variable">.axiOut_0_rvalid</span>(ram_rvalid),<br>      <span class="hljs-variable">.axiOut_0_rready</span>(ram_rready),<br>      <span class="hljs-variable">.axiOut_0_rdata</span> (ram_rdata),<br>      <span class="hljs-variable">.axiOut_0_rid</span>   (ram_rid),<br>      <span class="hljs-variable">.axiOut_0_rresp</span> (ram_rres),<br>      <span class="hljs-variable">.axiOut_0_rlast</span> (ram_rlast),<br>      <span class="hljs-comment">//slave1</span><br>      <span class="hljs-comment">//aw</span><br>      <span class="hljs-variable">.axiOut_1_awvalid</span>(uart_awvalid),<br>      <span class="hljs-variable">.axiOut_1_awready</span>(uart_awready),<br>      <span class="hljs-variable">.axiOut_1_awaddr</span> (uart_awaddr),<br>      <span class="hljs-variable">.axiOut_1_awid</span>   (uart_awid),<br>      <span class="hljs-variable">.axiOut_1_awlen</span>  (uart_awlen),<br>      <span class="hljs-variable">.axiOut_1_awsize</span> (uart_awsize),<br>      <span class="hljs-variable">.axiOut_1_awburst</span>(uart_awburst),<br>      <span class="hljs-variable">.axiOut_1_awlock</span> (uart_awlock),<br>      <span class="hljs-variable">.axiOut_1_awcache</span>(uart_awcache),<br>      <span class="hljs-variable">.axiOut_1_awprot</span> (uart_awprot),<br>      <span class="hljs-comment">//w</span><br>      <span class="hljs-variable">.axiOut_1_wvalid</span>(uart_wvalid),<br>      <span class="hljs-variable">.axiOut_1_wready</span>(uart_wready),<br>      <span class="hljs-variable">.axiOut_1_wdata</span> (uart_wdata),<br>      <span class="hljs-variable">.axiOut_1_wstrb</span> (uart_wstrb),<br>      <span class="hljs-variable">.axiOut_1_wlast</span> (uart_wlast),<br>      <span class="hljs-comment">//b</span><br>      <span class="hljs-variable">.axiOut_1_bready</span>(uart_bready),<br>      <span class="hljs-variable">.axiOut_1_bvalid</span>(uart_bvalid),<br>      <span class="hljs-variable">.axiOut_1_bid</span>   (uart_bid),<br>      <span class="hljs-variable">.axiOut_1_bresp</span> (uart_bresp),<br>      <span class="hljs-comment">//ar</span><br>      <span class="hljs-variable">.axiOut_1_arvalid</span>(uart_arvalid),<br>      <span class="hljs-variable">.axiOut_1_arready</span>(uart_arready),<br>      <span class="hljs-variable">.axiOut_1_araddr</span> (uart_araddr),<br>      <span class="hljs-variable">.axiOut_1_arid</span>   (uart_arid),<br>      <span class="hljs-variable">.axiOut_1_arlen</span>  (uart_arlen),<br>      <span class="hljs-variable">.axiOut_1_arsize</span> (uart_arsize),<br>      <span class="hljs-variable">.axiOut_1_arburst</span>(uart_arburst),<br>      <span class="hljs-variable">.axiOut_1_arlock</span> (uart_arlock),<br>      <span class="hljs-variable">.axiOut_1_arcache</span>(uart_arcache),<br>      <span class="hljs-variable">.axiOut_1_arprot</span> (uart_arprot),<br>      <span class="hljs-comment">//r</span><br>      <span class="hljs-variable">.axiOut_1_rvalid</span>(uart_rvalid),<br>      <span class="hljs-variable">.axiOut_1_rready</span>(uart_rready),<br>      <span class="hljs-variable">.axiOut_1_rdata</span> (uart_rdata),<br>      <span class="hljs-variable">.axiOut_1_rid</span>   (uart_rid),<br>      <span class="hljs-variable">.axiOut_1_rresp</span> (uart_rres),<br>      <span class="hljs-variable">.axiOut_1_rlast</span> (uart_rlast),<br>      <span class="hljs-comment">//slave3</span><br>      <span class="hljs-comment">//aw</span><br>      <span class="hljs-variable">.axiOut_3_awvalid</span>(confreg_awvalid),<br>      <span class="hljs-variable">.axiOut_3_awready</span>(confreg_awready),<br>      <span class="hljs-variable">.axiOut_3_awaddr</span> (confreg_awaddr),<br>      <span class="hljs-variable">.axiOut_3_awid</span>   (confreg_awid),<br>      <span class="hljs-variable">.axiOut_3_awlen</span>  (confreg_awlen),<br>      <span class="hljs-variable">.axiOut_3_awsize</span> (confreg_awsize),<br>      <span class="hljs-variable">.axiOut_3_awburst</span>(confreg_awburst),<br>      <span class="hljs-variable">.axiOut_3_awlock</span> (confreg_awlock),<br>      <span class="hljs-variable">.axiOut_3_awcache</span>(confreg_awcache),<br>      <span class="hljs-variable">.axiOut_3_awprot</span> (confreg_awprot),<br>      <span class="hljs-comment">//w</span><br>      <span class="hljs-variable">.axiOut_3_wvalid</span>(confreg_wvalid),<br>      <span class="hljs-variable">.axiOut_3_wready</span>(confreg_wready),<br>      <span class="hljs-variable">.axiOut_3_wdata</span> (confreg_wdata),<br>      <span class="hljs-variable">.axiOut_3_wstrb</span> (confreg_wstrb),<br>      <span class="hljs-variable">.axiOut_3_wlast</span> (confreg_wlast),<br>      <span class="hljs-comment">//b</span><br>      <span class="hljs-variable">.axiOut_3_bready</span>(confreg_bready),<br>      <span class="hljs-variable">.axiOut_3_bvalid</span>(confreg_bvalid),<br>      <span class="hljs-variable">.axiOut_3_bid</span>   (confreg_bid),<br>      <span class="hljs-variable">.axiOut_3_bresp</span> (confreg_bresp),<br>      <span class="hljs-comment">//ar</span><br>      <span class="hljs-variable">.axiOut_3_arvalid</span>(confreg_arvalid),<br>      <span class="hljs-variable">.axiOut_3_arready</span>(confreg_arready),<br>      <span class="hljs-variable">.axiOut_3_araddr</span> (confreg_araddr),<br>      <span class="hljs-variable">.axiOut_3_arid</span>   (confreg_arid),<br>      <span class="hljs-variable">.axiOut_3_arlen</span>  (confreg_arlen),<br>      <span class="hljs-variable">.axiOut_3_arsize</span> (confreg_arsize),<br>      <span class="hljs-variable">.axiOut_3_arburst</span>(confreg_arburst),<br>      <span class="hljs-variable">.axiOut_3_arlock</span> (confreg_arlock),<br>      <span class="hljs-variable">.axiOut_3_arcache</span>(confreg_arcache),<br>      <span class="hljs-variable">.axiOut_3_arprot</span> (confreg_arprot),<br>      <span class="hljs-comment">//r</span><br>      <span class="hljs-variable">.axiOut_3_rvalid</span>(confreg_rvalid),<br>      <span class="hljs-variable">.axiOut_3_rready</span>(confreg_rready),<br>      <span class="hljs-variable">.axiOut_3_rdata</span> (confreg_rdata),<br>      <span class="hljs-variable">.axiOut_3_rid</span>   (confreg_rid),<br>      <span class="hljs-variable">.axiOut_3_rresp</span> (confreg_rres),<br>      <span class="hljs-variable">.axiOut_3_rlast</span> (confreg_rlast)<br>  );<br>  <span class="hljs-comment">//例化sram</span><br>  <span class="hljs-comment">//axi ram</span><br>  axi_wrap_ram_sp_ext u_axi_ram (<br>      <span class="hljs-variable">.aclk</span>(sys_clk),<br>      <span class="hljs-variable">.aresetn</span>(sys_resetn),  <span class="hljs-comment">//ar .axi_arid ( ram_arid ),</span><br>      <span class="hljs-variable">.axi_araddr</span> (ram_araddr),<br>      <span class="hljs-variable">.axi_arlen</span>  (ram_arlen),<br>      <span class="hljs-variable">.axi_arsize</span> (ram_arsize),<br>      <span class="hljs-variable">.axi_arburst</span>(ram_arburst),<br>      <span class="hljs-variable">.axi_arlock</span> (ram_arlock),<br>      <span class="hljs-variable">.axi_arcache</span>(ram_arcache),<br>      <span class="hljs-variable">.axi_arprot</span> (ram_arprot),<br>      <span class="hljs-variable">.axi_arvalid</span>(ram_arvalid),<br>      <span class="hljs-variable">.axi_arready</span>(ram_arready),<br>      <span class="hljs-comment">//r</span><br>      <span class="hljs-variable">.axi_rid</span>(ram_rid),<br>      <span class="hljs-variable">.axi_rdata</span>(ram_rdata),<br>      <span class="hljs-variable">.axi_rresp</span>(ram_rresp),<br>      <span class="hljs-variable">.axi_rlast</span>(ram_rlast),<br>      <span class="hljs-variable">.axi_rvalid</span>(ram_rvalid),<br>      <span class="hljs-variable">.axi_rready</span>(ram_rready),<br>      <span class="hljs-comment">//aw</span><br>      <span class="hljs-variable">.axi_awid</span>(ram_awid),<br>      <span class="hljs-variable">.axi_awaddr</span>(ram_awaddr),<br>      <span class="hljs-variable">.axi_awlen</span>(ram_awlen),<br>      <span class="hljs-variable">.axi_awsize</span>(ram_awsize),<br>      <span class="hljs-variable">.axi_awburst</span>(ram_awburst),<br>      <span class="hljs-variable">.axi_awlock</span>(ram_awlock),<br>      <span class="hljs-variable">.axi_awcache</span>(ram_awcache),<br>      <span class="hljs-variable">.axi_awprot</span>(ram_awprot),<br>      <span class="hljs-variable">.axi_awvalid</span>(ram_awvalid),<br>      <span class="hljs-variable">.axi_awready</span>(ram_awready),<br>      <span class="hljs-comment">//w</span><br>      <span class="hljs-variable">.axi_wdata</span> (ram_wdata),<br>      <span class="hljs-variable">.axi_wstrb</span> (ram_wstrb),<br>      <span class="hljs-variable">.axi_wlast</span> (ram_wlast),<br>      <span class="hljs-variable">.axi_wvalid</span>(ram_wvalid),<br>      <span class="hljs-variable">.axi_wready</span>(ram_wready),<br>      <span class="hljs-comment">//b ram</span><br>      <span class="hljs-variable">.axi_bid</span>(ram_bid),<br>      <span class="hljs-variable">.axi_bresp</span>(ram_bresp),<br>      <span class="hljs-variable">.axi_bvalid</span>(ram_bvalid),<br>      <span class="hljs-variable">.axi_bready</span>(ram_bready),<br>      <span class="hljs-variable">.base_ram_addr</span>(base_ram_addr),<br>      <span class="hljs-variable">.base_ram_be_n</span>(base_ram_be_n),<br>      <span class="hljs-variable">.base_ram_ce_n</span>(base_ram_ce_n),<br>      <span class="hljs-variable">.base_ram_oe_n</span>(base_ram_oe_n),<br>      <span class="hljs-variable">.base_ram_we_n</span>(base_ram_we_n),<br>      <span class="hljs-variable">.ext_ram_addr</span> (ext_ram_addr),<br>      <span class="hljs-variable">.ext_ram_be_n</span> (ext_ram_be_n),<br>      <span class="hljs-variable">.ext_ram_ce_n</span> (ext_ram_ce_n),<br>      <span class="hljs-variable">.ext_ram_oe_n</span> (ext_ram_oe_n),<br>      <span class="hljs-variable">.ext_ram_we_n</span> (ext_ram_we_n),<br>      <span class="hljs-variable">.base_ram_data</span>(base_ram_data),<br>      <span class="hljs-variable">.ext_ram_data</span> (ext_ram_data)<br>  );<br>  <span class="hljs-comment">//例化uart</span><br>  <span class="hljs-comment">//uart</span><br>  <span class="hljs-keyword">wire</span> UART_CTS, UART_RTS;<br>  <span class="hljs-keyword">wire</span> UART_DTR, UART_DSR;<br>  <span class="hljs-keyword">wire</span> UART_RI, UART_DCD;<br>  <span class="hljs-keyword">assign</span> UART_CTS = <span class="hljs-number">1&#x27;b0</span>;<br>  <span class="hljs-keyword">assign</span> UART_DSR = <span class="hljs-number">1&#x27;b0</span>;<br>  <span class="hljs-keyword">assign</span> UART_DCD = <span class="hljs-number">1&#x27;b0</span>;<br>  <span class="hljs-keyword">assign</span> UART_RI  = <span class="hljs-number">1&#x27;b0</span>;<br>  <span class="hljs-keyword">wire</span> uart0_int;<br>  <span class="hljs-keyword">wire</span> uart0_txd_o;<br>  <span class="hljs-keyword">wire</span> uart0_txd_i;<br>  <span class="hljs-keyword">wire</span> uart0_txd_oe;<br>  <span class="hljs-keyword">wire</span> uart0_rxd_o;<br>  <span class="hljs-keyword">wire</span> uart0_rxd_i;<br>  <span class="hljs-keyword">wire</span> uart0_rxd_oe;<br>  <span class="hljs-keyword">wire</span> uart0_rts_o;<br>  <span class="hljs-keyword">wire</span> uart0_cts_i;<br>  <span class="hljs-keyword">wire</span> uart0_dsr_i;<br>  <span class="hljs-keyword">wire</span> uart0_dcd_i;<br>  <span class="hljs-keyword">wire</span> uart0_dtr_o;<br>  <span class="hljs-keyword">wire</span> uart0_ri_i;<br>  <span class="hljs-keyword">assign</span> UART_RX = uart0_rxd_oe ? <span class="hljs-number">1&#x27;bz</span> : uart0_rxd_o;<br>  <span class="hljs-keyword">assign</span> UART_TX = uart0_txd_oe ? <span class="hljs-number">1&#x27;bz</span> : uart0_txd_o;<br>  <span class="hljs-keyword">assign</span> UART_RTS = uart0_rts_o;<br>  <span class="hljs-keyword">assign</span> UART_DTR = uart0_dtr_o;<br>  <span class="hljs-keyword">assign</span> uart0_txd_i = UART_TX;<br>  <span class="hljs-keyword">assign</span> uart0_rxd_i = UART_RX;<br>  <span class="hljs-keyword">assign</span> uart0_cts_i = UART_CTS;<br>  <span class="hljs-keyword">assign</span> uart0_dcd_i = UART_DCD;<br>  <span class="hljs-keyword">assign</span> uart0_dsr_i = UART_DSR;<br>  <span class="hljs-keyword">assign</span> uart0_ri_i = UART_RI;<br>  <span class="hljs-comment">//UART_CONTROLLER</span><br>  axi_uart_controller u_axi_uart_controller (<br>      <span class="hljs-variable">.clk</span>  (sys_clk),<br>      <span class="hljs-variable">.rst_n</span>(sys_resetn),<br>      <span class="hljs-variable">.axi_s_awid</span>(uart_awid),<br>      <span class="hljs-variable">.axi_s_awaddr</span>(uart_awaddr),<br>      <span class="hljs-variable">.axi_s_awlen</span>(uart_awlen),<br>      <span class="hljs-variable">.axi_s_awsize</span>(uart_awsize),<br>      <span class="hljs-variable">.axi_s_awburst</span>(uart_awburst),<br>      <span class="hljs-variable">.axi_s_awlock</span>(uart_awlock),<br>      <span class="hljs-variable">.axi_s_awcache</span>(uart_awcache),<br>      <span class="hljs-variable">.axi_s_awprot</span>(uart_awprot),<br>      <span class="hljs-variable">.axi_s_awvalid</span>(uart_awvalid),<br>      <span class="hljs-variable">.axi_s_awready</span>(uart_awready),<br>      <span class="hljs-variable">.axi_s_wid</span>(uart_wid),<br>      <span class="hljs-variable">.axi_s_wdata</span>(uart_wdata),<br>      <span class="hljs-variable">.axi_s_wstrb</span>(uart_wstrb),<br>      <span class="hljs-variable">.axi_s_wlast</span>(uart_wlast),<br>      <span class="hljs-variable">.axi_s_wvalid</span>(uart_wvalid),<br>      <span class="hljs-variable">.axi_s_wready</span>(uart_wready),<br>      <span class="hljs-variable">.axi_s_bid</span>(uart_bid),<br>      <span class="hljs-variable">.axi_s_bresp</span>(uart_bresp),<br>      <span class="hljs-variable">.axi_s_bvalid</span>(uart_bvalid),<br>      <span class="hljs-variable">.axi_s_bready</span>(uart_bready),<br>      <span class="hljs-variable">.axi_s_arid</span>(uart_arid),<br>      <span class="hljs-variable">.axi_s_araddr</span>(uart_araddr),<br>      <span class="hljs-variable">.axi_s_arlen</span>(uart_arlen),<br>      <span class="hljs-variable">.axi_s_arsize</span>(uart_arsize),<br>      <span class="hljs-variable">.axi_s_arburst</span>(uart_arburst),<br>      <span class="hljs-variable">.axi_s_arlock</span>(uart_arlock),<br>      <span class="hljs-variable">.axi_s_arcache</span>(uart_arcache),<br>      <span class="hljs-variable">.axi_s_arprot</span>(uart_arprot),<br>      <span class="hljs-variable">.axi_s_arvalid</span>(uart_arvalid),<br>      <span class="hljs-variable">.axi_s_arready</span>(uart_arready),<br>      <span class="hljs-variable">.axi_s_rid</span>(uart_rid),<br>      <span class="hljs-variable">.axi_s_rdata</span>(uart_rdata),<br>      <span class="hljs-variable">.axi_s_rresp</span>(uart_rresp),<br>      <span class="hljs-variable">.axi_s_rlast</span>(uart_rlast),<br>      <span class="hljs-variable">.axi_s_rvalid</span>(uart_rvalid),<br>      <span class="hljs-variable">.axi_s_rready</span>(uart_rready),<br>      <span class="hljs-variable">.apb_rw_dma</span>(<span class="hljs-number">1&#x27;b0</span>),<br>      <span class="hljs-variable">.apb_psel_dma</span>(<span class="hljs-number">1&#x27;b0</span>),<br>      <span class="hljs-variable">.apb_enab_dma</span>(<span class="hljs-number">1&#x27;b0</span>),<br>      <span class="hljs-variable">.apb_addr_dma</span>(<span class="hljs-number">20&#x27;b0</span>),<br>      <span class="hljs-variable">.apb_valid_dma</span>(<span class="hljs-number">1&#x27;b0</span>),<br>      <span class="hljs-variable">.apb_wdata_dma</span>(<span class="hljs-number">32&#x27;b0</span>),<br>      <span class="hljs-variable">.apb_rdata_dma</span>(),<br>      <span class="hljs-variable">.apb_ready_dma</span>(),<br>      <span class="hljs-variable">.dma_grant</span>(),<br>      <span class="hljs-variable">.dma_req_o</span>(),<br>      <span class="hljs-variable">.dma_ack_i</span>(<span class="hljs-number">1&#x27;b0</span>),<br>      <span class="hljs-comment">//UART0 </span><br>      <span class="hljs-variable">.uart0_txd_i</span>(uart0_txd_i),<br>      <span class="hljs-variable">.uart0_txd_o</span>(uart0_txd_o),<br>      <span class="hljs-variable">.uart0_txd_oe</span>(uart0_txd_oe),<br>      <span class="hljs-variable">.uart0_rxd_i</span>(uart0_rxd_i),<br>      <span class="hljs-variable">.uart0_rxd_o</span>(uart0_rxd_o),<br>      <span class="hljs-variable">.uart0_rxd_oe</span>(uart0_rxd_oe),<br>      <span class="hljs-variable">.uart0_rts_o</span>(uart0_rts_o),<br>      <span class="hljs-variable">.uart0_dtr_o</span>(uart0_dtr_o),<br>      <span class="hljs-variable">.uart0_cts_i</span>(uart0_cts_i),<br>      <span class="hljs-variable">.uart0_dsr_i</span>(uart0_dsr_i),<br>      <span class="hljs-variable">.uart0_dcd_i</span>(uart0_dcd_i),<br>      <span class="hljs-variable">.uart0_ri_i</span>(uart0_ri_i),<br>      <span class="hljs-variable">.uart0_int</span>(uart0_int)<br>  );<br>  <span class="hljs-comment">//例化confreg</span><br>  confreg #(<br>      <span class="hljs-variable">.SIMULATION</span>(SIMULATION)<br>  ) u_confreg (<br>      <span class="hljs-variable">.aclk</span>(sys_clk),<br>      <span class="hljs-variable">.aresetn</span>(sys_resetn),<br>      <span class="hljs-variable">.cpu_clk</span>(cpu_clk),<br>      <span class="hljs-variable">.cpu_resetn</span>(cpu_resetn),<br>      <span class="hljs-variable">.s_awid</span>(confreg_awid),<br>      <span class="hljs-variable">.s_awaddr</span>(confreg_awaddr),<br>      <span class="hljs-variable">.s_awlen</span>(confreg_awlen),<br>      <span class="hljs-variable">.s_awsize</span>(confreg_awsize),<br>      <span class="hljs-variable">.s_awburst</span>(confreg_awburst),<br>      <span class="hljs-variable">.s_awlock</span>(confreg_awlock),<br>      <span class="hljs-variable">.s_awcache</span>(confreg_awcache),<br>      <span class="hljs-variable">.s_awprot</span>(confreg_awprot),<br>      <span class="hljs-variable">.s_awvalid</span>(confreg_awvalid),<br>      <span class="hljs-variable">.s_wid</span>(confreg_wid),<br>      <span class="hljs-variable">.s_wdata</span>(confreg_wdata),<br>      <span class="hljs-variable">.s_wstrb</span>(confreg_wstrb),<br>      <span class="hljs-variable">.s_wlast</span>(confreg_wlast),<br>      <span class="hljs-variable">.s_wvalid</span>(confreg_wvalid),<br>      <span class="hljs-variable">.s_bready</span>(confreg_bready),<br>      <span class="hljs-variable">.s_arid</span>(confreg_arid),<br>      <span class="hljs-variable">.s_araddr</span>(confreg_araddr),<br>      <span class="hljs-variable">.s_arlen</span>(confreg_arlen),<br>      <span class="hljs-variable">.s_arsize</span>(confreg_arsize),<br>      <span class="hljs-variable">.s_arburst</span>(confreg_arburst),<br>      <span class="hljs-variable">.s_arlock</span>(confreg_arlock),<br>      <span class="hljs-variable">.s_arcache</span>(confreg_arcache),<br>      <span class="hljs-variable">.s_arprot</span>(confreg_arprot),<br>      <span class="hljs-variable">.s_arvalid</span>(confreg_arvalid),<br>      <span class="hljs-variable">.s_rready</span>(confreg_rready),<br>      <span class="hljs-variable">.s_awready</span>(confreg_awready),<br>      <span class="hljs-variable">.s_wready</span>(confreg_wready),<br>      <span class="hljs-variable">.s_bid</span>(confreg_bid),<br>      <span class="hljs-variable">.s_bresp</span>(confreg_bresp),<br>      <span class="hljs-variable">.s_bvalid</span>(confreg_bvalid),<br>      <span class="hljs-variable">.s_arready</span>(confreg_arready),<br>      <span class="hljs-variable">.s_rid</span>(confreg_rid),<br>      <span class="hljs-variable">.s_rdata</span>(confreg_rdata),<br>      <span class="hljs-variable">.s_rresp</span>(confreg_rresp),<br>      <span class="hljs-variable">.s_rlast</span>(confreg_rlast),<br>      <span class="hljs-variable">.s_rvalid</span>(confreg_rvalid),<br>      <span class="hljs-variable">.switch</span>(dip_sw),<br>      <span class="hljs-variable">.touch_btn</span>(touch_btn),<br>      <span class="hljs-variable">.led</span>(leds),<br>      <span class="hljs-variable">.dpy0</span>(dpy0),<br>      <span class="hljs-variable">.dpy1</span>(dpy1),<br>      <span class="hljs-variable">.confreg_int</span>()<br>  );<br><span class="hljs-keyword">endmodule</span><br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>25-4-25</title>
    <link href="/2025/04/25/25-4-25/"/>
    <url>/2025/04/25/25-4-25/</url>
    
    <content type="html"><![CDATA[<figure class="highlight sas"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sas">hexo clean <span class="hljs-variable">&amp;&amp;</span> hexo g <span class="hljs-variable">&amp;&amp;</span> hexo d<br></code></pre></td></tr></table></figure><h1 id="今日份代码-——-主要是gocm"><a href="#今日份代码-——-主要是gocm" class="headerlink" title="今日份代码 —— 主要是gocm"></a>今日份代码 —— 主要是gocm</h1><p>还是那个问题，gocm最后小车突然停会抖，导致摄像头的s过大，导致速度过大</p><p>c的openmv代码</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs python">THRESHOLD = (<span class="hljs-number">0</span>, <span class="hljs-number">86</span>, <span class="hljs-number">5</span>, <span class="hljs-number">49</span>, <span class="hljs-number">5</span>, <span class="hljs-number">68</span>)<br><span class="hljs-keyword">import</span> sensor, image, time,math<br><span class="hljs-keyword">from</span> pyb <span class="hljs-keyword">import</span> LED<br><span class="hljs-keyword">from</span> pid <span class="hljs-keyword">import</span> PID<br><span class="hljs-keyword">from</span> machine <span class="hljs-keyword">import</span> UART<br>uart = UART(<span class="hljs-number">3</span>, <span class="hljs-number">115200</span>)<br>rho_pid = PID(p=<span class="hljs-number">0.3</span>, i=<span class="hljs-number">0</span>)<br>theta_pid = PID(p=<span class="hljs-number">0.004</span>, i=<span class="hljs-number">0</span>)<br>LED(<span class="hljs-number">1</span>).on()<br>LED(<span class="hljs-number">2</span>).on()<br>LED(<span class="hljs-number">3</span>).on()<br>sensor.reset()<br>sensor.set_vflip(<span class="hljs-literal">True</span>)<br>sensor.set_hmirror(<span class="hljs-literal">True</span>)<br>sensor.set_pixformat(sensor.RGB565)<br>sensor.set_framesize(sensor.QQQVGA)<br>sensor.skip_frames(time = <span class="hljs-number">2000</span>)<br>clock = time.clock()<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">sending_data3</span>(<span class="hljs-params">x</span>):<br>FH = <span class="hljs-built_in">bytearray</span>([x])<br>uart.write(FH);<br><span class="hljs-keyword">while</span>(<span class="hljs-literal">True</span>):<br>clock.tick()<br>img = sensor.snapshot().binary([THRESHOLD])<br>line = img.get_regression([(<span class="hljs-number">100</span>,<span class="hljs-number">100</span>)], robust = <span class="hljs-literal">True</span>)<br><span class="hljs-keyword">if</span> (line):<br>rho_err = <span class="hljs-built_in">abs</span>(line.rho())-img.width()/<span class="hljs-number">2</span><br><span class="hljs-keyword">if</span> line.theta()&gt;<span class="hljs-number">90</span>:<br>theta_err = line.theta()-<span class="hljs-number">180</span><br><span class="hljs-keyword">else</span>:<br>theta_err = line.theta()<br>img.draw_line(line.line(), color = <span class="hljs-number">127</span>)<br><span class="hljs-built_in">print</span>(rho_err,line.magnitude(),rho_err)<br><span class="hljs-keyword">if</span> line.magnitude()&gt;<span class="hljs-number">8</span>:<br>rho_output = rho_pid.get_pid(rho_err,<span class="hljs-number">1</span>)<br>theta_output = theta_pid.get_pid(theta_err,<span class="hljs-number">1</span>)<br>output = rho_output+theta_output<br>e = <span class="hljs-number">123</span><br>d = <span class="hljs-string">&quot;%d&quot;</span> %(output)<br>uart.write(<span class="hljs-string">&#x27;a&#x27;</span>);<br>uart.write(<span class="hljs-string">&#x27;b&#x27;</span>);<br>uart.write(d);<br>uart.write(<span class="hljs-string">&#x27;e&#x27;</span>);<br>time.sleep_ms(<span class="hljs-number">5</span>)<br><span class="hljs-keyword">else</span>:<br>uart.write(<span class="hljs-string">&#x27;a&#x27;</span>);<br>uart.write(<span class="hljs-string">&#x27;b&#x27;</span>);<br>uart.write(<span class="hljs-string">&#x27;0&#x27;</span>);<br>uart.write(<span class="hljs-string">&#x27;e&#x27;</span>);<br>time.sleep_ms(<span class="hljs-number">5</span>)<br><span class="hljs-keyword">else</span>:<br>sending_data3(<span class="hljs-number">0x00</span>);<br>time.sleep_ms(<span class="hljs-number">5</span>)<br><span class="hljs-keyword">pass</span><br></code></pre></td></tr></table></figure><p>小车工程的串口和主函数的</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">if</span>(x==<span class="hljs-number">1</span>)<br>  Load(<span class="hljs-number">30</span><span class="hljs-number">-4</span>*s,<span class="hljs-number">30</span>+<span class="hljs-number">4</span>*s);<br>  <span class="hljs-keyword">if</span>(g_ucUsart2ReceiveData==<span class="hljs-number">0x00</span>&amp;&amp;x==<span class="hljs-number">1</span>&amp;&amp;m==<span class="hljs-number">0</span>&amp;&amp;k==<span class="hljs-number">0</span>)&#123;<br>  HAL_Delay(<span class="hljs-number">500</span>);<br>  Load(<span class="hljs-number">10</span>,<span class="hljs-number">-10</span>);<br>  <span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>)&#123;<span class="hljs-keyword">if</span>(g_ucUsart2ReceiveData!=<span class="hljs-number">0x00</span>&amp;&amp;s==<span class="hljs-number">0</span>)<span class="hljs-keyword">break</span>;HAL_Delay(<span class="hljs-number">1</span>);&#125;<br>  m=<span class="hljs-number">1</span>;<br>  &#125;<br>  <span class="hljs-keyword">if</span>(g_ucUsart2ReceiveData==<span class="hljs-number">0x00</span>&amp;&amp;x==<span class="hljs-number">1</span>&amp;&amp;m==<span class="hljs-number">1</span>&amp;&amp;k==<span class="hljs-number">0</span>)&#123;<br>  HAL_Delay(<span class="hljs-number">500</span>);<br>  Load(<span class="hljs-number">10</span>,<span class="hljs-number">-10</span>);<br>  <span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>)&#123;<span class="hljs-keyword">if</span>(g_ucUsart2ReceiveData!=<span class="hljs-number">0x00</span>&amp;&amp;s==<span class="hljs-number">0</span>)<span class="hljs-keyword">break</span>;HAL_Delay(<span class="hljs-number">1</span>);&#125;<br>  m=<span class="hljs-number">1</span>;k=<span class="hljs-number">1</span>;<br>  &#125;<br>  <span class="hljs-keyword">if</span>(g_ucUsart2ReceiveData==<span class="hljs-number">0x00</span>&amp;&amp;x==<span class="hljs-number">1</span>&amp;&amp;m==<span class="hljs-number">1</span>&amp;&amp;k==<span class="hljs-number">1</span>)&#123;<br>  HAL_Delay(<span class="hljs-number">500</span>);<br>  Load(<span class="hljs-number">-20</span>,<span class="hljs-number">20</span>);<br>  HAL_Delay(<span class="hljs-number">550</span>);<br>  Load(<span class="hljs-number">20</span>,<span class="hljs-number">20</span>);<br>   HAL_Delay(<span class="hljs-number">950</span>);<br>   Load(<span class="hljs-number">-10</span>,<span class="hljs-number">10</span>);<br><br> HAL_Delay(<span class="hljs-number">700</span>);<br> <span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>)&#123;<span class="hljs-keyword">if</span>(g_ucUsart2ReceiveData!=<span class="hljs-number">0x00</span>&amp;&amp;s==<span class="hljs-number">0</span>)<span class="hljs-keyword">break</span>;HAL_Delay(<span class="hljs-number">1</span>);&#125;<br> Load(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);<br>  HAL_Delay(<span class="hljs-number">20</span>);<br>  m=<span class="hljs-number">0</span>;k=<span class="hljs-number">0</span>;<br>  &#125;<br></code></pre></td></tr></table></figure><p>串口</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">HAL_UART_RxCpltCallback</span><span class="hljs-params">(UART_HandleTypeDef *huart)</span><br>&#123;<br><span class="hljs-keyword">if</span>( huart==&amp;huart6)<br>&#123;<br><span class="hljs-comment">//HAL_UART_Transmit(&amp;huart1,&amp;rx1,1,50);</span><br>usartCamera_Receive_Data(g_ucUsart2ReceiveData);<br>HAL_UART_Receive_IT(&amp;huart6,&amp;g_ucUsart2ReceiveData,<span class="hljs-number">1</span>);<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>处理数据的函数</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">usartCamera_Receive_Data</span><span class="hljs-params">(<span class="hljs-type">uint8_t</span> data)</span><br>&#123;<br><span class="hljs-type">static</span> <span class="hljs-type">uint8_t</span> state = <span class="hljs-number">0</span>;<span class="hljs-comment">//定义静态static 变量</span><br><br><span class="hljs-keyword">if</span>(state==<span class="hljs-number">0</span>&amp;&amp;data==<span class="hljs-number">0x61</span>) <span class="hljs-comment">//判断第一个是不是帧头0xA5</span><br>&#123;<br>state=<span class="hljs-number">1</span>;<span class="hljs-comment">//是帧头0xA5 赋值state=1 表示接收下一个数据</span><br><span class="hljs-comment">//数据存储在数组中 &quot;g_ucUsart2ReceivCounter++&quot;,这里是先用后加，比如g_ucUsart2ReceivCounter 初值为0，执行这个是先g_ucaUsart3ReceiveBuffer[0]=data，然后g_ucUsart3ReceivCounter++，即后g_ucUsart3ReceivCounter = 1的</span><br>g_ucaUsart2ReceiveBuffer[g_ucUsart2ReceivCounter++] = data;<br>&#125;<br><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(state==<span class="hljs-number">1</span>&amp;&amp;data==<span class="hljs-number">0x62</span>) <span class="hljs-comment">//第二个是不是帧头0xA6</span><br>&#123;<br>state=<span class="hljs-number">2</span>;<span class="hljs-comment">//如果第二个是帧头0xA6 赋值state=2 表示接收下一个数据</span><br>g_ucaUsart2ReceiveBuffer[g_ucUsart2ReceivCounter++] = data;<span class="hljs-comment">//保存数据</span><br>&#125;<br><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(state==<span class="hljs-number">2</span>)<span class="hljs-comment">//然后确定开头是0XA5 0XA6 就开始接收</span><br>&#123;<br>g_ucaUsart2ReceiveBuffer[g_ucUsart2ReceivCounter++]=data;<br><span class="hljs-keyword">if</span>(g_ucUsart2ReceivCounter&gt;<span class="hljs-number">9</span>||data==<span class="hljs-number">0x65</span>) state=<span class="hljs-number">3</span>;  <span class="hljs-comment">//接收大于9个或者接收到帧尾0X5B 就置位状态三</span><br>&#125;<br><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(state==<span class="hljs-number">3</span>) <span class="hljs-comment">//状态三</span><br>&#123;<br>x=<span class="hljs-number">1</span>;<br>s=<span class="hljs-number">0</span>;<br><span class="hljs-keyword">if</span>(g_ucaUsart2ReceiveBuffer[g_ucUsart2ReceivCounter<span class="hljs-number">-1</span>] == <span class="hljs-number">0x65</span>)  <span class="hljs-comment">//确定 最后一个是不是0x5B帧尾 是帧尾0x5B 就认为通信正确 处理数据</span><br>&#123;<br>state = <span class="hljs-number">0</span>;<span class="hljs-comment">//这里就可以处理数据了、处理完记得清空数组和重置标志位与计数值</span><br><br><span class="hljs-keyword">if</span>(g_ucaUsart2ReceiveBuffer[<span class="hljs-number">2</span>]!=<span class="hljs-number">0x2d</span>)<br>            &#123;<br><span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;<br><span class="hljs-keyword">for</span>(i=<span class="hljs-number">2</span>;i&lt;g_ucUsart2ReceivCounter<span class="hljs-number">-1</span>;i++)<br>&#123;<br>s*=<span class="hljs-number">10</span>;<br><span class="hljs-keyword">if</span>(g_ucaUsart2ReceiveBuffer[i]<span class="hljs-number">-48</span>&lt;<span class="hljs-number">10</span>)<br>s+=(g_ucaUsart2ReceiveBuffer[i]<span class="hljs-number">-48</span>);<br>&#125;<br>&#125;<br><span class="hljs-keyword">else</span><br>&#123;<br><span class="hljs-type">int</span> q=<span class="hljs-number">0</span>;<br><span class="hljs-keyword">for</span>(q=<span class="hljs-number">3</span>;q&lt;g_ucUsart2ReceivCounter<span class="hljs-number">-1</span>;q++)<br>&#123;<br>s*=<span class="hljs-number">10</span>;<br><span class="hljs-keyword">if</span>(g_ucaUsart2ReceiveBuffer[q]<span class="hljs-number">-48</span>&lt;<span class="hljs-number">10</span>)<br>s+=(g_ucaUsart2ReceiveBuffer[q]<span class="hljs-number">-48</span>);<br>&#125;<br>s=-s;<br>&#125;<br>g_ucUsart2ReceivCounter = <span class="hljs-number">0</span>;<span class="hljs-comment">//清零计数值</span><br><span class="hljs-comment">//2.然后清空数组</span><br><span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;<span class="hljs-number">10</span>;i++)&#123; g_ucaUsart2ReceiveBuffer[i]=<span class="hljs-number">0x00</span>;&#125;<span class="hljs-comment">//清空数组</span><br><br><span class="hljs-keyword">return</span> s;<br>&#125;<br><span class="hljs-keyword">else</span><span class="hljs-comment">//不是帧尾说明通信错误重新开始接收</span><br>&#123;<br>state=<span class="hljs-number">0</span>;<br>g_ucUsart2ReceivCounter =<span class="hljs-number">0</span>;<br><span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;<span class="hljs-number">10</span>;i++) &#123; g_ucaUsart2ReceiveBuffer[i]=<span class="hljs-number">0x00</span>;&#125;<span class="hljs-comment">//清空数组</span><br>s=<span class="hljs-number">0</span>;<br>&#125;<br>&#125;<br><span class="hljs-keyword">else</span><br>&#123;<span class="hljs-comment">//其他异常清空</span><br>state=<span class="hljs-number">0</span>;<br>g_ucUsart2ReceivCounter =<span class="hljs-number">0</span>;<br><span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> i=<span class="hljs-number">0</span>;i&lt;<span class="hljs-number">10</span>;i++) g_ucaUsart2ReceiveBuffer[i]=<span class="hljs-number">0x00</span>;<span class="hljs-comment">//清空数组</span><br>s=<span class="hljs-number">0</span>;<br>&#125;<br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<span class="hljs-comment">//</span><br>&#125;<br></code></pre></td></tr></table></figure><p>前12个二维码的值</p><p><a href="https://5v60oq.58u.cn/a/RlYaaoM/">https://5v60oq.58u.cn/a/RlYaaoM/</a><br><a href="https://5v60oq.58u.cn/a/bDNqqqx/">https://5v60oq.58u.cn/a/bDNqqqx/</a><br><a href="https://5v60oq.58u.cn/a/RMkwwwj/">https://5v60oq.58u.cn/a/RMkwwwj/</a><br><a href="https://5v60oq.58u.cn/a/Ay4eeeX/">https://5v60oq.58u.cn/a/Ay4eeeX/</a><br><a href="https://5v60oq.58u.cn/a/O8eDDDV/">https://5v60oq.58u.cn/a/O8eDDDV/</a><br><a href="https://5v60oq.58u.cn/a/O9Dmmmy/">https://5v60oq.58u.cn/a/O9Dmmmy/</a><br><a href="https://5v60oq.58u.cn/a/OdB888K/">https://5v60oq.58u.cn/a/OdB888K/</a><br><a href="https://5v60oq.58u.cn/a/AGwdddv/">https://5v60oq.58u.cn/a/AGwdddv/</a><br><a href="https://5v60oq.58u.cn/a/AQp7778/">https://5v60oq.58u.cn/a/AQp7778/</a><br><a href="https://5v60oq.58u.cn/a/R4e222J/">https://5v60oq.58u.cn/a/R4e222J/</a><br><a href="https://5v60oq.58u.cn/a/AV8YYYN/">https://5v60oq.58u.cn/a/AV8YYYN/</a><br><a href="https://5v60oq.58u.cn/a/AxqWWWQ/">https://5v60oq.58u.cn/a/AxqWWWQ/</a></p><p>目前写的识别二维码的代码</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 二维码识别示例</span><br><span class="hljs-keyword">import</span> sensor, image, time<br><span class="hljs-keyword">from</span> machine <span class="hljs-keyword">import</span> UART <span class="hljs-comment">#引入串口模块</span><br>sensor.reset()<br>sensor.set_pixformat(sensor.GRAYSCALE)<br>sensor.set_framesize(sensor.VGA)<br>sensor.set_windowing((<span class="hljs-number">240</span>, <span class="hljs-number">240</span>)) <span class="hljs-comment"># 看VGA分辨率中间的240x240像素。</span><br>sensor.skip_frames(<span class="hljs-number">30</span>)<br>sensor.set_auto_gain(<span class="hljs-literal">False</span>)  <span class="hljs-comment"># 必须关闭此功能，以防止图像冲洗…</span><br><br>uart = UART(<span class="hljs-number">3</span>, <span class="hljs-number">115200</span>)<br>clock = time.clock()<br>last_payload = <span class="hljs-literal">None</span>  <span class="hljs-comment"># 用来保存上一次识别到的二维码内容</span><br>THRESHOLD = (<span class="hljs-number">0</span>, <span class="hljs-number">120</span>)  <span class="hljs-comment"># 可以根据具体情况调整阈值，0 是黑色，100 是白色</span><br><span class="hljs-keyword">while</span>(<span class="hljs-literal">True</span>):<br>    clock.tick()<br>    img = sensor.snapshot()<br>   <span class="hljs-comment"># for code in img.find_qrcodes():</span><br>    <span class="hljs-comment">#    print(code)</span><br>    <span class="hljs-comment">#img.binary([THRESHOLD])  # 对图像进行二值化处理</span><br>    codes = img.find_qrcodes()<br>    <span class="hljs-keyword">if</span> codes:<br>        payload = codes[<span class="hljs-number">0</span>].payload()  <span class="hljs-comment"># 假设只识别一个二维码</span><br>        <span class="hljs-keyword">if</span> payload != last_payload:<br>            last_payload = payload<br>            <span class="hljs-built_in">print</span>(payload)<br>            <span class="hljs-keyword">if</span> payload == <span class="hljs-string">&quot;https://5v60oq.58u.cn/a/RlYaaoM/&quot;</span> <span class="hljs-keyword">or</span> payload ==<span class="hljs-string">&quot;1&quot;</span>:<br>                out = <span class="hljs-string">&quot;1&quot;</span><br>                uart.write(<span class="hljs-string">&#x27;a&#x27;</span>)<br>                uart.write(<span class="hljs-string">&#x27;c&#x27;</span>)<br>                uart.write(out)<br>                uart.write(<span class="hljs-string">&#x27;e&#x27;</span>)<br>            <span class="hljs-keyword">elif</span> payload == <span class="hljs-string">&quot;https://5v60oq.58u.cn/a/bDNqqqx/&quot;</span> <span class="hljs-keyword">or</span> payload ==<span class="hljs-string">&quot;2&quot;</span>:<br>                out = <span class="hljs-string">&quot;2&quot;</span><br>                uart.write(<span class="hljs-string">&#x27;a&#x27;</span>)<br>                uart.write(<span class="hljs-string">&#x27;c&#x27;</span>)<br>                uart.write(out)<br>                uart.write(<span class="hljs-string">&#x27;e&#x27;</span>)<br>            <span class="hljs-keyword">elif</span> payload == <span class="hljs-string">&quot;https://5v60oq.58u.cn/a/RMkwwwj/&quot;</span> <span class="hljs-keyword">or</span> payload ==<span class="hljs-string">&quot;3&quot;</span>:<br>                out = <span class="hljs-string">&quot;3&quot;</span><br>                uart.write(<span class="hljs-string">&#x27;a&#x27;</span>)<br>                uart.write(<span class="hljs-string">&#x27;c&#x27;</span>)<br>                uart.write(out)<br>                uart.write(<span class="hljs-string">&#x27;e&#x27;</span>)<br>            <span class="hljs-keyword">elif</span> payload == <span class="hljs-string">&quot;https://5v60oq.58u.cn/a/Ay4eeeX/&quot;</span> <span class="hljs-keyword">or</span> payload ==<span class="hljs-string">&quot;4&quot;</span>:<br>                out = <span class="hljs-string">&quot;4&quot;</span><br>                uart.write(<span class="hljs-string">&#x27;a&#x27;</span>)<br>                uart.write(<span class="hljs-string">&#x27;c&#x27;</span>)<br>                uart.write(out)<br>                uart.write(<span class="hljs-string">&#x27;e&#x27;</span>)<br>            <span class="hljs-keyword">elif</span> payload == <span class="hljs-string">&quot;https://5v60oq.58u.cn/a/O8eDDDV/&quot;</span> <span class="hljs-keyword">or</span> payload ==<span class="hljs-string">&quot;5&quot;</span>:<br>                out = <span class="hljs-string">&quot;5&quot;</span><br>                uart.write(<span class="hljs-string">&#x27;a&#x27;</span>)<br>                uart.write(<span class="hljs-string">&#x27;c&#x27;</span>)<br>                uart.write(out)<br>                uart.write(<span class="hljs-string">&#x27;e&#x27;</span>)<br>            <span class="hljs-keyword">elif</span> payload == <span class="hljs-string">&quot;https://5v60oq.58u.cn/a/O9Dmmmy/&quot;</span> <span class="hljs-keyword">or</span> payload ==<span class="hljs-string">&quot;6&quot;</span>:<br>                out = <span class="hljs-string">&quot;6&quot;</span><br>                uart.write(<span class="hljs-string">&#x27;a&#x27;</span>)<br>                uart.write(<span class="hljs-string">&#x27;c&#x27;</span>)<br>                uart.write(out)<br>                uart.write(<span class="hljs-string">&#x27;e&#x27;</span>)<br>            <span class="hljs-keyword">elif</span> payload == <span class="hljs-string">&quot;https://5v60oq.58u.cn/a/OdB888K/&quot;</span> <span class="hljs-keyword">or</span> payload ==<span class="hljs-string">&quot;7&quot;</span>:<br>                out = <span class="hljs-string">&quot;7&quot;</span><br>                uart.write(<span class="hljs-string">&#x27;a&#x27;</span>)<br>                uart.write(<span class="hljs-string">&#x27;c&#x27;</span>)<br>                uart.write(out)<br>                uart.write(<span class="hljs-string">&#x27;e&#x27;</span>)<br>            <span class="hljs-keyword">elif</span> payload == <span class="hljs-string">&quot;https://5v60oq.58u.cn/a/AGwdddv/&quot;</span> <span class="hljs-keyword">or</span> payload ==<span class="hljs-string">&quot;8&quot;</span>:<br>                out = <span class="hljs-string">&quot;8&quot;</span><br>                uart.write(<span class="hljs-string">&#x27;a&#x27;</span>)<br>                uart.write(<span class="hljs-string">&#x27;c&#x27;</span>)<br>                uart.write(out)<br>                uart.write(<span class="hljs-string">&#x27;e&#x27;</span>)<br>            <span class="hljs-keyword">elif</span> payload == <span class="hljs-string">&quot;https://5v60oq.58u.cn/a/AQp7778/&quot;</span> <span class="hljs-keyword">or</span> payload ==<span class="hljs-string">&quot;9&quot;</span>:<br>                out = <span class="hljs-string">&quot;9&quot;</span><br>                uart.write(<span class="hljs-string">&#x27;a&#x27;</span>)<br>                uart.write(<span class="hljs-string">&#x27;c&#x27;</span>)<br>                uart.write(out)<br>                uart.write(<span class="hljs-string">&#x27;e&#x27;</span>)<br>            <span class="hljs-keyword">elif</span> payload == <span class="hljs-string">&quot;https://5v60oq.58u.cn/a/R4e222J/&quot;</span> <span class="hljs-keyword">or</span> payload ==<span class="hljs-string">&quot;10&quot;</span>:<br>                out = <span class="hljs-string">&quot;10&quot;</span><br>                uart.write(<span class="hljs-string">&#x27;a&#x27;</span>)<br>                uart.write(<span class="hljs-string">&#x27;c&#x27;</span>)<br>                uart.write(out)<br>                uart.write(<span class="hljs-string">&#x27;e&#x27;</span>)<br>            <span class="hljs-keyword">elif</span> payload == <span class="hljs-string">&quot;https://5v60oq.58u.cn/a/AV8YYYN/&quot;</span> <span class="hljs-keyword">or</span> payload ==<span class="hljs-string">&quot;11&quot;</span>:<br>                out = <span class="hljs-string">&quot;11&quot;</span><br>                uart.write(<span class="hljs-string">&#x27;a&#x27;</span>)<br>                uart.write(<span class="hljs-string">&#x27;c&#x27;</span>)<br>                uart.write(out)<br>                uart.write(<span class="hljs-string">&#x27;e&#x27;</span>)<br>            <span class="hljs-keyword">elif</span> payload == <span class="hljs-string">&quot;https://5v60oq.58u.cn/a/AxqWWWQ/&quot;</span> <span class="hljs-keyword">or</span> payload ==<span class="hljs-string">&quot;12&quot;</span>:<br>                out = <span class="hljs-string">&quot;12&quot;</span><br>                uart.write(<span class="hljs-string">&#x27;a&#x27;</span>)<br>                uart.write(<span class="hljs-string">&#x27;c&#x27;</span>)<br>                uart.write(out)<br>                uart.write(<span class="hljs-string">&#x27;e&#x27;</span>)<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>25-4-20</title>
    <link href="/2025/04/20/25-4-20/"/>
    <url>/2025/04/20/25-4-20/</url>
    
    <content type="html"><![CDATA[<figure class="highlight sas"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sas">hexo clean <span class="hljs-variable">&amp;&amp;</span> hexo g <span class="hljs-variable">&amp;&amp;</span> hexo d<br></code></pre></td></tr></table></figure><h1 id="一、"><a href="#一、" class="headerlink" title="一、"></a>一、</h1><p>​c在搞通讯。</p><p>​通讯搞好了，目前在弄循迹。小车不在我这测不了距离，不用步进电机应该可以吧，想买个麦克轮but没money算了，又报销不了。</p><p>​把ppt做了，之后看下位置PID，积分限幅那些加上。</p><p>​让小车走一定距离的误差大可能是因为没弄位置环？到指定距离后有惯性停不下来。之后看下江科大讲的看能不能改下代码，加上摄像头巡线误差肯定更大。<br>​今天啥都没干光测了距离。之后向c要下摄像头和通信的代码。不对还有个问题，转弯的时候踩线了，如果摄像头能识别拐角会更好。</p><h1 id="二、一些代码"><a href="#二、一些代码" class="headerlink" title="二、一些代码"></a>二、一些代码</h1><p>这是行驶一段距离的代码</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">gocm</span><span class="hljs-params">(<span class="hljs-type">int</span> cm)</span><br>&#123;<br><span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>)<br>    &#123;<br>        Milleage_flag = <span class="hljs-number">1</span>;<br>        motorPidSetSpeed(<span class="hljs-number">1</span>,<span class="hljs-number">1</span>);<br>        <span class="hljs-keyword">if</span>((<span class="hljs-type">int</span>)Mileage &gt;= cm * <span class="hljs-number">10</span>)<br>        &#123;<br>            Load(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);<br>            Mileage = <span class="hljs-number">0</span>;<br>            Milleage_flag = <span class="hljs-number">0</span>;<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>        HAL_Delay(<span class="hljs-number">5</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>中断里面算速度和里程</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">if</span>(htim == &amp;htim3)<span class="hljs-comment">//htim3  500HZ 2ms中断一次</span><br>&#123; <br><br>TimerCount++;<span class="hljs-comment">//每次进入中断 、中断计数变量递增</span><br><span class="hljs-keyword">if</span>(TimerCount %<span class="hljs-number">5</span> == <span class="hljs-number">0</span>)<span class="hljs-comment">//每10ms 执行一次</span><br>&#123; <br>Encode1Count = -(<span class="hljs-type">short</span>)__HAL_TIM_GET_COUNTER(&amp;htim4);<span class="hljs-comment">//获得当前编码器计数值并赋值 (short):是类型转化 -:是因为电机对侧安装</span><br>Encode2Count = (<span class="hljs-type">short</span>)__HAL_TIM_GET_COUNTER(&amp;htim2);<br>cnt2+=Encode1Count;<br>__HAL_TIM_SET_COUNTER(&amp;htim2,<span class="hljs-number">0</span>);<span class="hljs-comment">//每次获得编码器计数值后都清零，这样每次计数值就是变化量</span><br>__HAL_TIM_SET_COUNTER(&amp;htim4,<span class="hljs-number">0</span>);<br><span class="hljs-comment">/* 电机速度 = 编码器计数值`*编码器读取频率/减速比/编码器线数/4倍频 */</span><br>Motor1Speed = (<span class="hljs-type">float</span>)Encode1Count*<span class="hljs-number">100</span>/<span class="hljs-number">28</span>/<span class="hljs-number">13</span>/<span class="hljs-number">4</span>;<br>    Motor2Speed = (<span class="hljs-type">float</span>)Encode2Count*<span class="hljs-number">100</span>/<span class="hljs-number">28</span>/<span class="hljs-number">13</span>/<span class="hljs-number">4</span>;<br>go_left  += <span class="hljs-number">0.01f</span>*Motor1Speed*<span class="hljs-number">204.2f</span>;<br>go_right += <span class="hljs-number">0.01f</span>*Motor1Speed*<span class="hljs-number">204.2f</span>;<br>go += <span class="hljs-number">0.005f</span>*(Motor1Speed+Motor2Speed)*<span class="hljs-number">204.2f</span>;<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d,%.2f,%.2f,%.2f,%.2f,%.2f,%.2f,%.2f\r\n&quot;</span>,cnt2,Mileage1,Mileage,Motor1Speed,g_ftracingPidOut1,pidMotor2Speed.target_val,pidMotor2Speed.err_sum,out);<br>&#125;<br>        <span class="hljs-keyword">if</span>(Milleage_flag == <span class="hljs-number">1</span>)<br>        &#123;<br><span class="hljs-keyword">if</span>(TimerCount %<span class="hljs-number">5</span> == <span class="hljs-number">0</span>)<span class="hljs-comment">//每10ms执行一次</span><br>            &#123;<br>               <span class="hljs-comment">/*里程 += 时间*电机速度*周长*/</span><br>Mileage1 += <span class="hljs-number">0.01f</span>*Motor1Speed*<span class="hljs-number">204.2f</span>;<br>Mileage2 += <span class="hljs-number">0.01f</span>*Motor2Speed*<span class="hljs-number">204.2f</span>;<br>Mileage += <span class="hljs-number">0.005f</span>*(Motor1Speed+Motor2Speed)*<span class="hljs-number">204.2f</span>;<br>               <span class="hljs-comment">/*控制电机转速*/</span><br>                <span class="hljs-comment">//Load(PID_realize2(&amp;pidMotor1Speed,Motor1Speed),PID_realize2(&amp;pidMotor2Speed,Motor2Speed));</span><br>                TimerCount=<span class="hljs-number">0</span>;<br>            &#125;<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure><p>这是11昨天发的识别最大色块中心点x坐标的代码</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> sensor, image, time,math,machine<br><span class="hljs-keyword">from</span> pyb <span class="hljs-keyword">import</span> UART<br><span class="hljs-keyword">from</span> vl53l1x <span class="hljs-keyword">import</span> VL53L1X<br><span class="hljs-keyword">from</span> pyb <span class="hljs-keyword">import</span> LED<br><br>uart_A = UART(<span class="hljs-number">3</span>, <span class="hljs-number">115200</span>)<br>green_led = LED(<span class="hljs-number">2</span>)<br>sensor.reset()<br>sensor.set_pixformat(sensor.RGB565)<br><span class="hljs-comment"># 关闭自动白平衡</span><br>sensor.set_auto_exposure(<span class="hljs-literal">False</span>)<br>sensor.set_auto_whitebal(<span class="hljs-literal">False</span>)<br>sensor.set_auto_gain(<span class="hljs-literal">False</span>)<br>sensor.set_framesize(sensor.QQVGA)<br>sensor.skip_frames(<span class="hljs-number">10</span>)<br>clock = time.clock()<br><br>red_threshold=(<span class="hljs-number">70</span>, <span class="hljs-number">100</span>, <span class="hljs-number">5</span>, <span class="hljs-number">124</span>, -<span class="hljs-number">128</span>, <span class="hljs-number">127</span>)<br>green_threshold=(<span class="hljs-number">43</span>, <span class="hljs-number">100</span>, -<span class="hljs-number">35</span>, -<span class="hljs-number">128</span>, <span class="hljs-number">11</span>, <span class="hljs-number">127</span>)<br>lastx = <span class="hljs-number">0</span><br>lastx2 = <span class="hljs-number">0</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">sending_data3</span>(<span class="hljs-params">x</span>):<br>    FH = <span class="hljs-built_in">bytearray</span>([x])<br>    uart_A.write(FH);<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">send_uart</span>(<span class="hljs-params">deflection_angle,deflection_angle2</span>):<br>    sending_data3(<span class="hljs-number">0xA5</span>)<br>    time.sleep_ms(<span class="hljs-number">5</span>)<br>    sending_data3(deflection_angle)<br>    time.sleep_ms(<span class="hljs-number">5</span>)<br>    sending_data3(deflection_angle2)<br>    time.sleep_ms(<span class="hljs-number">5</span>)<br>    sending_data3(<span class="hljs-number">0x5B</span>)<br>    time.sleep_ms(<span class="hljs-number">5</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">find_max</span>(<span class="hljs-params">blobs</span>):<br>    max_size=<span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> blob <span class="hljs-keyword">in</span> blobs:<br>        <span class="hljs-keyword">if</span> blob[<span class="hljs-number">2</span>]*blob[<span class="hljs-number">3</span>] &gt; max_size:<br>            max_blob=blob<br>            max_size = blob[<span class="hljs-number">2</span>]*blob[<span class="hljs-number">3</span>]<br>    <span class="hljs-keyword">return</span> max_blob<br><br><span class="hljs-keyword">while</span>(<span class="hljs-literal">True</span>):<br>    clock.tick()<br>    img = sensor.snapshot()<br>    green_led.on()<br>    blobs = img.find_blobs([red_threshold])<br>    <span class="hljs-keyword">if</span> blobs:<br>        max_blob = find_max(blobs)<br>        lastx = max_blob.cx()<br>        <span class="hljs-comment">#lasty = max_blob.cy()</span><br>        img.draw_cross(max_blob.cx(), max_blob.cy())<br>    blobs2 = img.find_blobs([green_threshold])<br>    <span class="hljs-keyword">if</span> blobs2:<br>        max_blob2 = find_max(blobs2)<br>        lastx2 = max_blob2.cx()<br>        <span class="hljs-comment">#lasty = max_blob.cy()</span><br>        img.draw_cross(max_blob2.cx(), max_blob2.cy())<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;lastx:&quot;</span>,lastx,<span class="hljs-string">&quot;lastx2:&quot;</span>,lastx2)<br>    <span class="hljs-keyword">if</span> lastx != <span class="hljs-number">0</span> <span class="hljs-keyword">and</span> lastx2 != <span class="hljs-number">0</span>:<br>        send_uart(lastx,lastx2)<br>        <br></code></pre></td></tr></table></figure><p>11发的32联合openmv发的坐标值的调整速度的代码。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c">diffx = ballx - target_x;      <span class="hljs-comment">//最大色块的中心值和目标值(80)相减</span><br>      diffx = diffx &gt; <span class="hljs-number">40</span>? <span class="hljs-number">40</span> :diffx;<br>      diffx = diffx &lt; <span class="hljs-number">-40</span>? <span class="hljs-number">-40</span> :diffx;<br>      g_ftracingPidOut = PID_realize(&amp;pidpositionx,diffx);<br>      g_ftracingPidOut1 = <span class="hljs-number">0</span> + g_ftracingPidOut;<span class="hljs-comment">//主要还是原地的移动，保持在视线的中心</span><br>      g_ftracingPidOut2 = <span class="hljs-number">0</span> - g_ftracingPidOut;<br>      <span class="hljs-keyword">if</span> (g_ftracingPidOut1 &gt; <span class="hljs-number">2.7f</span>) g_ftracingPidOut1 = <span class="hljs-number">2.7f</span>;<br>      <span class="hljs-keyword">if</span> (g_ftracingPidOut1 &lt; <span class="hljs-number">-2.7f</span>) g_ftracingPidOut1 = <span class="hljs-number">-2.7f</span>;<br>      <span class="hljs-keyword">if</span> (g_ftracingPidOut2 &gt; <span class="hljs-number">2.7f</span>) g_ftracingPidOut2 = <span class="hljs-number">2.7f</span>;<br>      <span class="hljs-keyword">if</span> (g_ftracingPidOut2 &lt; <span class="hljs-number">-2.7f</span>) g_ftracingPidOut2 = <span class="hljs-number">-2.7f</span>;<br>      motorPidSetSpeed(g_ftracingPidOut1,g_ftracingPidOut2);<br>      HAL_Delay(<span class="hljs-number">5</span>);<span class="hljs-comment">//非常的重要！！！！！！！</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>25-4-19</title>
    <link href="/2025/04/19/25-4-19/"/>
    <url>/2025/04/19/25-4-19/</url>
    
    <content type="html"><![CDATA[<h1 id="一、校赛（5-4截止）"><a href="#一、校赛（5-4截止）" class="headerlink" title="一、校赛（5.4截止）"></a>一、校赛（5.4截止）</h1><h2 id="1-第一块板子"><a href="#1-第一块板子" class="headerlink" title="1.第一块板子"></a>1.第一块板子</h2><p>​11画了板子，but 输出不了3.3V，且一个串口和要用到的TIM冲突了（他看错了吗），本来觉得没问题，但openmv需要3.3V供电，陈你怎么没发现啊。总之现在用模块输出。</p><p>​地图到了我才发现。陈在搞摄像头。串口那个代码太复杂了，我之后看下蓝桥杯的串口改一下，变量名也太长。</p><p>​昨天今天看了PID，江科大讲的还挺细。</p><p>​但是目前还不知道之后的代码怎么写，看陈那边的摄像头如何吧，能识别拐弯的话应该能轻松一点。</p><h2 id="2-第二块板子"><a href="#2-第二块板子" class="headerlink" title="2.第二块板子"></a>2.第二块板子</h2>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Hello World</title>
    <link href="/2025/04/19/hello-world/"/>
    <url>/2025/04/19/hello-world/</url>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo new <span class="hljs-string">&quot;My New Post&quot;</span><br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo server<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo generate<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo deploy<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  
</search>
